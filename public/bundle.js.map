{"version":3,"file":"bundle.js","sources":["../src/utils.js","../src/AudioSample.js","../src/drawdna.js","../src/graphics.js","../src/scorecanvas.js","../src/gameio.js","../src/Game.js","../src/Point.js","../src/loader.js","../src/Grid.js","../src/Worm.js","../src/main.js"],"sourcesContent":["// utils.js\n\nexport function log ( str )  {\n  if ($('#logging').slider().val() == \"true\") {\n    console.log( str );\n  }\n}\n","/**\n * Created by dmaynard on 1/19/15.\n */\nimport { darworms } from \"./loader.js\";\nimport {\n  log\n} from \"./utils.js\"\n\nexport default function AudioSample(name, location) {\n    this.location = location;\n    this.name = name;\n    this.incomingbuffer = undefined;\n    this.savedBuffer = undefined;\n    var xhr = new XMLHttpRequest();\n    xhr.open('get',location, true);\n    xhr.responseType = 'arraybuffer';\n    xhr.onload = (function () {\n        darworms.audioContext.decodeAudioData(xhr.response,\n            (function(incomingBuffer) {\n                // log( \"on Load incoming Buffer\");\n                // log(\" xhr \" + xhr.status + \"  \" + xhr.statusText);\n                // log(\" incoming buffer = \" + incomingBuffer );\n                // log ( \" this.name \" + this.name);\n                this.savedBuffer = incomingBuffer; // Save the buffer, we'll reuse it\n            }\n        ).bind(this));\n    }).bind(this);\n    xhr.send();\n    darworms.audioSamples.push(this);\n}\n\nAudioSample.prototype.playSample = function (rate, pan) {\n    var source;\n    // log(\" playSample \" + this.name + \"  \" + this.location + \"  savedBuffer \" + this.savedBuffer);\n    if (darworms.audioContext !== undefined && this.savedBuffer !== undefined) {\n        // Do we have to create a new buffer every time we play a note ?\n        source = darworms.audioContext.createBufferSource();\n        source.buffer = this.savedBuffer;\n        darworms.masterGainNode.gain.value = darworms.dwsettings.masterAudioVolume;\n        source.connect(darworms.masterGainNode);\n        // log(\" playSample \" + this.name + \" volume  \" + darworms.masterGainNode.gain.value);\n        if ( darworms.audioPanner !== undefined ) {\n          darworms.masterGainNode.connect(darworms.audioPanner);\n          darworms.audioPanner.connect(darworms.audioContext.destination);\n        }\n        else {\n          darworms.masterGainNode.connect(darworms.audioContext.destination);\n        }\n\n        if ( darworms.audioPanner !== undefined ) {\n          darworms.audioPanner.pan.value = (pan * 0.80) ;  // jump cut is too harsh\n        }\n        source.start(0); // Play sound immediately. Renamed source.start from source.noteOn\n        if (rate ) {\n          source.playbackRate.value = rate;\n        }\n\n    }\n};\n","import { Point } from \"./Point.js\";\nimport { darworms } from \"./loader.js\";\n/**\n\n\n/*    drawdna  */\n  //  although we reserve 4 bits for each direction we actually only use 3 bits\n  const spokeMask = [0xFFFFFFF0,\n    0xFFFFFF0F,\n    0xFFFFF0FF,\n    0xFFFF0FFF,\n    0xFFF0FFFF,\n    0xFF0FFFFF,\n    0xF0FFFFFF,\n    0x0FFFFFFF\n  ];\n\n  const xPts = [0.8, 0.4, -0.4, -0.8, -0.4, 0.4];\n  const yPts = [0.0, .67, .67, 0.0, -.67, -.67];\n\n  const sinkMask = 0x08000000;\n  let pGraphics = null;\n\n  export function drawdna ( canvas, darworm, cellstate)  {\n    let width = canvas.clientWidth;\n    let height = canvas.clientHeight;\n    pGraphics = canvas.getContext(\"2d\");\n    // I have NO IDEA why this scale factor is needed\n    // but experiment proves it IS needed to make circles round\n    // and to fill the canvasIsDirty\n    // this may be a JQuery mobile bug?\n    pGraphics.setTransform( 1.5*width/2.0, 0, 0, .75*height/2, 1.5*width/2.0, .75*height/2);\n\n    pGraphics.fillStyle = darworms.dwsettings.cellBackground[darworms.dwsettings.backGroundTheme];\n    pGraphics.strokeStyle = 'black'; // black\n    pGraphics.lineWidth = 0.02;\n    pGraphics.rect(-1,-1,2,2);\n    pGraphics.fill();\n    pGraphics.beginPath();\n    pGraphics.moveTo(xPts[0], yPts[0]);\n    for (var j = 1; j < 6; j = j + 1) {\n      pGraphics.lineTo(xPts[j], yPts[j]);\n    }\n    pGraphics.lineTo(xPts[0], yPts[0]);\n    // pGraphics.closePath();\n    pGraphics.stroke();\n\n    for (var j = 0, mask = 0x1; j < 6; j++, mask <<= 1) {\n      pGraphics.setLineDash (((cellstate & mask) == 0) ? [.02, .02] : []);\n      pGraphics.lineWidth = ((cellstate & mask) == 0) ? 0.01 :  0.04 ;\n      pGraphics.beginPath();\n      pGraphics.moveTo(0,0);\n      pGraphics.lineTo(xPts[j], yPts[j]);\n      pGraphics.stroke();\n    }\n    pGraphics.setLineDash([]);\n  }\n","import {\n  Point\n} from \"./Point.js\";\nimport {\n  darworms\n} from \"./loader.js\";\nimport {\n  log\n} from \"./utils.js\"\n\nexport var wGraphics;\nexport var wCanvas;\nexport var scale; // this really shouldm't be needed eleswhere\nvar gridSize = new Point(0, 0);\nvar grid; // module global passed in at init time\n\nlet xPts = [1.0, 0.5, -0.5, -1.0, -0.5, 0.5];\nlet yPts = [0.0, 1.0, 1.0, 0.0, -1.0, -1.0];\nlet asterixSize = 0.2;\nlet timeInDraw = 0;\nlet gameElapsedTime = 0;\nexport let frameTimes = [];\nexport let startFrameTimes = [];\nlet dirtyCells = [];\nlet theGame = null;\nexport function graphicsInit(game) {\n  wCanvas = document.getElementById(\"wcanvas\");\n  wGraphics = wCanvas.getContext(\"2d\");\n  resizeCanvas()\n\n}\nexport function setGrid(currentGrid, game) {\n  grid = currentGrid;\n  timeInDraw = 0;\n  frameTimes.length = 0;\n  startFrameTimes.length = 0;\n  theGame = game;\n\n}\n\nexport function setScale(gridWidth, gridHeight) {\n  scale = new Point((wCanvas.width / (gridWidth + 1.5)), (wCanvas.height / (gridHeight + 1)));\n  gridSize = new Point(gridWidth, gridHeight);\n}\nexport function reScale(gridWidth, gridHeight) {\n  setScale(gridWidth, gridHeight);\n  log(\" reScaled to \" + scale.format());\n};\n\nexport function clearCanvas() {\n  // Store the current transformation matrix\n  wGraphics.save();\n  // Use the identity matrix while clearing the canvas\n  wGraphics.setTransform(1, 0, 0, 1, 0, 0);\n  wGraphics.clearRect(0, 0, wCanvas.width, wCanvas.height);\n  wGraphics.fillStyle = darworms.dwsettings.cellBackground[darworms.dwsettings.backGroundTheme];\n  wGraphics.fillStyle = \"#F5F5F500\";\n  wGraphics.fillRect(0, 0, wCanvas.width, wCanvas.height);\n\n  // Restore the transform\n  wGraphics.restore();\n  //    wGraphics.clearRect(0,0,canvas.width,canvas.height);\n};\n\nexport function startGameTimer() {\n  gameElapsedTime = -new Date().getTime();\n}\n\nexport function stopGameTimer() {\n  gameElapsedTime += new Date().getTime();\n}\nexport function getOffset(point) {\n  var xoff;\n  var yoff;\n  if ((point.y & 1) === 0) {\n    xoff = ((point.x + 0.5) * (scale.x)) + (scale.x / 2);\n  } else {\n    xoff = ((point.x + 1.0) * (scale.x)) + (scale.x / 2);\n  }\n  yoff = ((point.y + 0.5) * (scale.y)) + (scale.y / 2);\n  return new Point(xoff, yoff);\n}\n\nexport function gsetTranslate(point) {\n  var cellOffset = getOffset(point);\n  wGraphics.setTransform(scale.x, 0, 0, scale.y, cellOffset.x, cellOffset.y);\n  // log( \"Drawing cell \" +  point.format() + \" x= \" + cellOffset.x + \"  y= \" + cellOffset.y);\n};\n\n\nexport function drawCells() {\n  if (grid) {\n    wGraphics.save();\n    for (var col = 0; col < grid.width; col = col + 1) {\n      for (var row = 0; row < grid.height; row = row + 1) {\n        drawcell(new Point(col, row));\n      }\n    }\n    wGraphics.restore();\n  }\n};\n\nexport function drawcell(point) {\n  // if (point.isEqualTo(new Point (this.grid.width-1, this.grid.height/2))) {\n  //     log(this.grid.formatStateAt(point));\n  // }\n  timeInDraw -= Date.now();\n  // wGraphics.save();\n  gsetTranslate(point);\n  var owner = grid.spokeAt(point, 7);\n  wGraphics.lineWidth = 2.0 / scale.x;\n  //  first clear cell to prevent multiple cals to drawcell from\n  // darkening the cell  (multiple calls to the same cell are made to\n  // highlite worm positions and animate death.\n  // perhaps we should add a parameter to the call indicating whether clear is needsReDraw\n\n  wGraphics.strokeStyle = darworms.dwsettings.colorTable[owner & 0xF];\n  wGraphics.fillStyle =\n    darworms.dwsettings.cellBackground[darworms.dwsettings.backGroundTheme];\n\n  wGraphics.beginPath();\n  wGraphics.moveTo(darworms.graphics.vertex_x[0], darworms.graphics.vertex_y[0]);\n  for (var j = 1; j < 6; j = j + 1) {\n    wGraphics.lineTo(darworms.graphics.vertex_x[j], darworms.graphics.vertex_y[j]);\n  }\n  // wGraphics.moveTo(darworms.graphics.vertex_x[0], darworms.graphics.vertex_y[0]);\n  wGraphics.stroke();\n\n  wGraphics.closePath();\n  wGraphics.fill();\n  // wGraphics.stroke();\n\n  if (owner) {\n    wGraphics.strokeStyle = darworms.dwsettings.colorTable[owner & 0xF];\n    wGraphics.fillStyle =\n      darworms.dwsettings.alphaColorTable[owner & 0xF];\n    wGraphics.beginPath();\n    wGraphics.moveTo(darworms.graphics.vertex_x[0], darworms.graphics.vertex_y[0]);\n    for (var j = 1; j < 6; j = j + 1) {\n      wGraphics.lineTo(darworms.graphics.vertex_x[j], darworms.graphics.vertex_y[j]);\n    }\n    // wGraphics.moveTo(darworms.graphics.vertex_x[0], darworms.graphics.vertex_y[0]);\n    wGraphics.stroke();\n    wGraphics.closePath();\n    wGraphics.fill();\n  }\n\n  // wGraphics.stroke();\n\n\n\n  wGraphics.fillStyle = darworms.dwsettings.alphaColorTable[grid.spokeAt(point, 6) & 0xF];\n\n\n  // wGraphics.fillStyle =  darworms.dwsettings.cellBackground[1-darworms.dwsettings.backGroundTheme];\n  wGraphics.lineWidth = 2.0 / scale.x;\n  wGraphics.beginPath();\n  wGraphics.arc(0, 0, 0.1, 0, Math.PI * 2, true);\n  wGraphics.closePath();\n  wGraphics.fill();\n  //  draw hex outline\n  wGraphics.strokeStyle = darworms.dwsettings.cellBackground[1 - darworms.dwsettings.backGroundTheme];\n  wGraphics.lineWidth = 1.0 / scale.x;\n  wGraphics.beginPath();\n  wGraphics.moveTo(darworms.graphics.vertex_x[0], darworms.graphics.vertex_y[0]);\n  for (var j = 1; j < 6; j = j + 1) {\n    wGraphics.lineTo(darworms.graphics.vertex_x[j], darworms.graphics.vertex_y[j]);\n  }\n  wGraphics.lineTo(darworms.graphics.vertex_x[0], darworms.graphics.vertex_y[0]);\n  wGraphics.stroke();\n  wGraphics.closePath();\n\n  var outvec = grid.outVectorsAt(point);\n  var invec = grid.inVectorsAt(point);\n  // log (\" drawCell at\" +  point.format() + \" outVectors 0x\" + outvec.toString(16) + \" inVectors 0x\" + invec.toString(16));\n\n  for (var i = 0; i < 6; i = i + 1) {\n    if ((outvec & darworms.outMask[i]) !== 0) {\n      var outSpokeColor = darworms.dwsettings.colorTable[grid.spokeAt(point, i)];\n      // log (\" outSpokeColor \" + i + \" :  \" + outSpokeColor + \" at \"  + point.format());\n      wGraphics.strokeStyle = outSpokeColor;\n      wGraphics.lineWidth = 2.0 / scale.x;\n      wGraphics.lineCap = 'round';\n      wGraphics.beginPath();\n      wGraphics.moveTo(0, 0);\n      wGraphics.lineTo(xPts[i], yPts[i]);\n      wGraphics.stroke();\n      wGraphics.closePath();\n    }\n    if ((invec & darworms.outMask[i]) !== 0) {\n      wGraphics.strokeStyle = darworms.dwsettings.colorTable[grid.spokeAt(point, i)];\n      wGraphics.lineWidth = 2.0 / scale.x;\n      wGraphics.lineCap = 'round';\n      wGraphics.beginPath();\n      wGraphics.moveTo(xPts[i], yPts[i]);\n      wGraphics.lineTo(0, 0);\n      wGraphics.stroke();\n      wGraphics.closePath();\n    }\n  }\n  if (grid.isSink(point)) {\n    wGraphics.strokeStyle = darworms.dwsettings.colorTable[0];\n    for (var k = 0; k < 3; k = k + 1) {\n      var m = ((k + 3) % 6);\n      wGraphics.beginPath();\n      wGraphics.moveTo(xPts[k] * asterixSize, yPts[k] * asterixSize);\n      wGraphics.lineTo(xPts[m] * asterixSize, yPts[m] * asterixSize);\n      wGraphics.stroke();\n      wGraphics.closePath();\n      wGraphics.lineTo(darworms.graphics.vertex_x[j], darworms.graphics.vertex_y[j]);\n    }\n  };\n  timeInDraw += Date.now();\n}\nexport function drawDirtyCells() {\n  var pt;\n  // wGraphics.save();\n  // log(\" Grawing dirty cells\" + this.dirtyCells.length);\n  while ((pt = dirtyCells.pop()) !== undefined) {\n    drawcell(pt);\n  }\n  // wGraphics.restore();\n};\n\nexport function pushDirtyCell(pos) {\n  dirtyCells.push(pos);\n}\nexport function highlightWorm(worm, index) {\n  if (worm.state === darworms.gameStates.waiting) {\n    gsetTranslate(worm.pos);\n\n    wGraphics.fillStyle = darworms.dwsettings.cellBackground[darworms.dwsettings.backGroundTheme];\n    wGraphics.beginPath();\n    wGraphics.arc(0, 0, 0.2, 0, Math.PI * 2, true);\n    wGraphics.closePath();\n    wGraphics.fill();\n\n    wGraphics.fillStyle = darworms.dwsettings.alphaColorTable[worm.colorIndex];\n    wGraphics.beginPath();\n    wGraphics.arc(0, 0, 0.2 * ((darworms.graphics.animFrame & 0x1F) / 0x1F), 0, Math.PI * 2, true);\n    wGraphics.closePath();\n    wGraphics.fill();\n\n  }\n}\n\nexport function initPickUI(worm) {\n\n  log(\" initPickUI\")\n  darworms.pickCells = new Array();\n  var outvec = this.grid.outVectorsAt(worm.pos);\n  var inVec = this.grid.inVectorsAt(worm.pos);\n  // log (\" drawCell at\" +  point.format() + \" outVectors 0x\" + outvec.toString(16) + \" inVectors 0x\" + invec.toString(16));\n\n  for (var dir = 0; dir < 6; dir = dir + 1) {\n    if (((outvec & darworms.outMask[dir]) == 0) && ((inVec & darworms.outMask[dir]) == 0)) {\n      var pickTarget = {};\n      pickTarget.pos = this.grid.next(worm.pos, dir);\n      pickTarget.dir = dir;\n      pickTarget.color = darworms.dwsettings.alphaColorTable[theGame.focusWorm.colorIndex];\n      pickTarget.wormColorIndex = theGame.focusWorm.colorIndex;\n      darworms.pickCells.push(pickTarget);\n    }\n  }\n}\n\n\nexport function drawPickCells() {\n  var animFraction = 1.0 * (darworms.graphics.animFrame & 0x7F) / 128;\n  if ((darworms.dwsettings.pickDirectionUI == 1) && (animFraction < 0.1)) {\n    clearCanvas();\n    drawCells(); // shound use backbuffer instead of redrawing?\n  };\n\n  darworms.pickCells.forEach(function(pickTarget) {\n    drawPickCell(pickTarget.pos, pickTarget.color);\n  });\n  drawPickCellOrigin(darworms.theGame.focusWorm.pos,\n    darworms.dwsettings.alphaColorTable[darworms.theGame.focusWorm.colorIndex]);\n\n  if (darworms.dwsettings.pickDirectionUI == 1) {\n    darworms.pickCells.forEach(function(pickTarget) {\n      drawExpandedTarget(pickTarget);\n    });\n  }\n\n  darworms.theGame.worms.forEach(function(worm, index) {\n    highlightWorm(worm, index);\n  }, darworms.theGame);\n}\n\n\nexport function drawPickCell(point, activeColor) {\n  // wGraphics.save();\n  gsetTranslate(point);\n  wGraphics.fillStyle = darworms.dwsettings.cellBackground[darworms.dwsettings.backGroundTheme];\n  // wGraphics.fillRect(-0.5, -0.5, 1.0, 1.0);\n  var owner = this.grid.spokeAt(point, 7);\n  if (owner !== 0) {\n    log(\" Why is an owned cell a target selection? \" + point.format(point));\n  }\n  drawcell(point); // set up original background for this cell\n\n  var animFraction = 1.0 * (darworms.graphics.animFrame & 0x3F) / 64;\n\n  wGraphics.strokeStyle = activeColor;\n  wGraphics.fillStyle = activeColor;\n  wGraphics.beginPath();\n  wGraphics.moveTo(darworms.graphics.vertex_x[0] * animFraction, darworms.graphics.vertex_y[0] * animFraction);\n  for (var j = 1; j < 6; j = j + 1) {\n    wGraphics.lineTo(darworms.graphics.vertex_x[j] * animFraction, darworms.graphics.vertex_y[j] * animFraction);\n  }\n  wGraphics.moveTo(darworms.graphics.vertex_x[0], darworms.graphics.vertex_y[0]);\n  wGraphics.stroke();\n  wGraphics.closePath();\n  wGraphics.fill();\n  // wGraphics.stroke();\n\n\n\n  wGraphics.fillStyle = darworms.dwsettings.alphaColorTable[this.grid.spokeAt(point, 6) & 0xF];\n};\nexport function drawPickCellOrigin(point, activeColor) {\n  // wGraphics.save();\n  gsetTranslate(point);\n  wGraphics.fillStyle = darworms.dwsettings.cellBackground[darworms.dwsettings.backGroundTheme];\n  // wGraphics.fillRect(-0.5, -0.5, 1.0, 1.0);\n  var owner = this.grid.spokeAt(point, 7);\n  if (owner !== 0) {\n    log(\" Why is an owned cell a target selection origin? \" + point.format(point));\n  }\n  drawcell(point); // set up original backgrounf for this cell\n\n  var animFraction = 1.0 * (darworms.graphics.animFrame & 0x3F) / 64;\n\n  wGraphics.strokeStyle = activeColor;\n  wGraphics.fillStyle = activeColor;\n  var outvec = this.grid.outVectorsAt(point);\n  var invec = this.grid.inVectorsAt(point);\n  for (var dir = 0; dir < 6; dir = dir + 1) {\n    if (((outvec & darworms.outMask[dir]) == 0) && ((invec & darworms.outMask[dir]) == 0)) {\n\n\n      wGraphics.lineWidth = 3.0 / scale.x;\n      wGraphics.lineCap = 'round';\n      wGraphics.beginPath();\n      wGraphics.moveTo(0, 0);\n      wGraphics.lineTo(xPts[dir] * animFraction, yPts[dir] * animFraction);\n      wGraphics.stroke();\n      wGraphics.closePath();\n\n    }\n\n  }\n\n};\nexport function drawExpandedTarget(pickTarget) {\n  // Draw the up to six large pick targets on screen perimeter\n  var screenCoordinates = getOffset(pickTarget.pos);\n\n  wGraphics.save();\n\n\n  const fillColorString = darworms.dwsettings.alphaColorTable[pickTarget.wormColorIndex];\n\n  wGraphics.strokeStyle = fillColorString;\n\n  wGraphics.lineWidth = 4;\n  wGraphics.setTransform(1.0, 0, 0, 1.0, 0, 0);\n  wGraphics.beginPath();\n  var xloc = ((xPts[pickTarget.dir] * wCanvas.width * .75) / 2) + (wCanvas.width / 2);\n  var yloc = ((yPts[pickTarget.dir] * wCanvas.height * .75) / 2) + (wCanvas.height / 2);\n\n  wGraphics.arc(xloc, yloc, 20, 0, Math.PI * 2, false);\n  wGraphics.closePath();\n  wGraphics.stroke();\n\n  wGraphics.strokeStyle = fillColorString;\n  wGraphics.lineWidth = 2;\n  wGraphics.moveTo(xloc, yloc);\n  wGraphics.beginPath();\n  wGraphics.moveTo(xloc, yloc);\n  var animFraction = 1.0 * (darworms.graphics.animFrame & 0x7F) / 128;\n  wGraphics.lineTo(\n    (xloc + ((screenCoordinates.x - xloc) * animFraction)),\n    (yloc + ((screenCoordinates.y - yloc) * animFraction)));\n\n  wGraphics.closePath();\n  wGraphics.stroke();\n  wGraphics.restore();\n}\n\nexport function selectDirection(point) {\n  ((darworms.dwsettings.pickDirectionUI == 1)) ? selectLargeUIDirection(point):\n    selectSmallUIDirection(point);\n}\n\nfunction selectSmallUIDirection(touchPoint) {\n  // we should be able to bind the forEach to this instead using darworms.theGame\n  darworms.pickCells.forEach(function(pickTarget) {\n    var screenCoordinates = getOffset(pickTarget.pos);\n    var absdiff = touchPoint.absDiff(screenCoordinates);\n    var diff = new Point(touchPoint.x - screenCoordinates.x, touchPoint.y - screenCoordinates.y);\n    if ((absdiff.x < (scale.x / 2)) && (absdiff.y < (scale.y / 2)) &&\n      this.gameState === darworms.gameStates.waiting) {\n      log(\" target hit delta: \" + diff.format());\n      setDNAandResumeGame(pickTarget.dir);\n    }\n  }, darworms.theGame);\n\n}\n\nfunction setDNAandResumeGame(direction) {\n  theGame.focusWorm.dna[theGame.focusValue & 0x3F] = direction;\n  theGame.focusWorm.numChoices += 1;\n  darworms.theGame.gameState = darworms.gameStates.running;\n  clearCanvas();\n  drawCells();\n}\n\nfunction selectLargeUIDirection(point) {\n  // log( \"selectDirection: \" + point.format());\n  var outvec = darworms.theGame.grid.stateAt(theGame.focusWorm.pos);\n  var minDist = 100000;\n  var dist;\n  var select = -1;\n  for (var i = 0; i < 6; i = i + 1) {\n    if ((outvec & darworms.outMask[i]) === 0) {\n      const target = new Point(\n        (((darworms.theGame.xPts[i] * wCanvas.width * .75) / 2) + (wCanvas.width / 2)),\n        (((darworms.theGame.yPts[i] * wCanvas.height * .75) / 2) + (wCanvas.height / 2)));\n\n      // log(\" direction: \" + i + \" target point \" + target.format());\n      // log(\"Touch Point: \" + point.format());\n      dist = target.dist(point);\n      //  Actual pixel coordinates\n      if (dist < minDist) {\n        minDist = dist;\n        select = i;\n      }\n      // log(\"selectDirection i: \" + i + \"  dist: \" + dist + \" Min Dist:\" + minDist);\n    }\n  }\n  if ((minDist < wCanvas.width / 8) && (select >= 0)) {\n    setDNAandResumeGame(select);\n  }\n};\n\nexport function animateDyingWorms() {\n  for (var i = 0; i < 4; i = i + 1) {\n    // We don't want to do the animates in the same order ever frame because\n    // when tow worms die together the second's animations would always overwite\n    // the first's/\n\n    var whichWorm = ((i + darworms.graphics.uiFrames) & 0x3);\n    if (theGame.worms[whichWorm].state == darworms.wormStates.dying) {\n      animateDyingCell(theGame.worms[whichWorm]);\n    }\n  }\n}\n\nfunction animateDyingCell(worm) {\n  drawcell(worm.pos);\n  drawShrikingOutline(worm);\n}\n\nfunction drawShrikingOutline(worm) {\n  var animFraction = (darworms.graphics.dyningAnimationFrames - (darworms.graphics.uiFrames - worm.diedAtFrame)) /\n    darworms.graphics.dyningAnimationFrames;\n  gsetTranslate(worm.pos);\n\n  wGraphics.strokeStyle = darworms.dwsettings.alphaColorTable[worm.colorIndex];\n  wGraphics.lineWidth = .1;\n  wGraphics.fillStyle = darworms.dwsettings.alphaColorTable[worm.colorIndex];\n  wGraphics.beginPath();\n  wGraphics.moveTo(darworms.graphics.vertex_x[0] * animFraction, darworms.graphics.vertex_y[0] * animFraction);\n  for (var j = 1; j < 6; j = j + 1) {\n    wGraphics.lineTo(darworms.graphics.vertex_x[j] * animFraction, darworms.graphics.vertex_y[j] * animFraction);\n  }\n  wGraphics.lineTo(darworms.graphics.vertex_x[0] * animFraction, darworms.graphics.vertex_y[0] * animFraction);\n  //wGraphics.stroke();\n  wGraphics.closePath();\n  wGraphics.stroke();\n  //wGraphics.fill();\n  // wGraphics.stroke();\n}\n\nexport function showTimes() {\n  var min = 100000000;\n  var max = 0;\n  var ave = 0;\n  var nFrames = 0;\n  var sumTime = 0;\n  var fps = 0;\n  log(\"frameTimes.length \" + frameTimes.length);\n  for (var i = 0; i < frameTimes.length; i = i + 1) {\n    nFrames = nFrames + 1;\n    if (frameTimes[i] > max) {\n      max = frameTimes[i];\n    }\n    if (frameTimes[i] < min) {\n      min = frameTimes[i];\n    }\n    sumTime = sumTime + frameTimes[i];\n  }\n  if (nFrames > 0) {\n    ave = Math.round(sumTime / nFrames * 100) / 100;\n  }\n  var totalElapsed = new Date().getTime() - startFrameTimes[0];\n  var percentDrawing = Math.round((sumTime * 100 / totalElapsed * 100)) / 100;\n  // var percentDrawing = (sumTime * 100 / totalElapsed);\n\n  if (gameElapsedTime > 0) {\n    fps = Math.round(nFrames * 1000 / gameElapsedTime * 100) / 100;\n  }\n  document.getElementById('wormframes').innerHTML = nFrames;\n  document.getElementById('wormmintime').innerHTML = min;\n  document.getElementById('wormmaxtime').innerHTML = max;\n  document.getElementById('wormavetime').innerHTML = ave;\n  document.getElementById('wormframetargettime').innerHTML = 1000 / $(\"#fps\").val();\n\n  document.getElementById('wormfps').innerHTML = fps;\n  //  frame Intervals.  How often did out update get called\n  min = 1000000;\n  max = 0;\n  nFrames = 0;\n  sumTime = 0;\n  ave = 0;\n  var delta = 0;\n  for (i = 1; i < startFrameTimes.length; i = i + 1) {\n    nFrames = nFrames + 1;\n    delta = startFrameTimes[i] - startFrameTimes[i - 1];\n    if (delta > max) {\n      max = delta;\n    }\n    if (delta < min) {\n      min = delta;\n    }\n    sumTime = sumTime + delta;\n  }\n  if (nFrames > 0) {\n    ave = Math.round(sumTime / nFrames * 100) / 100;\n  }\n  document.getElementById('wormframemintime').innerHTML = min;\n  document.getElementById('wormframemaxtime').innerHTML = max;\n  document.getElementById('wormframeavetime').innerHTML = ave;\n  document.getElementById('wormframepercenttime').innerHTML = percentDrawing;\n  document.getElementById('wormframetotaltime').innerHTML = timeInDraw / 1000;\n\n\n};\n\n//  set the wcanvas dimensions based on the window dimentions\nexport function resizeCanvas() {\n  var xc = $('#wcanvas');\n  var canvasElement = document.getElementById('wcanvas');\n  var sc = $('#scorecanvas');\n  var nc = $('#navcontainer');\n  var fb = $('#footerbar');\n  var w = $(window).width();\n  var h = $(window).height();\n  var widescreen = w / (h - 140);\n  if (widescreen > 2.0) {\n    w = 2.0 * (h - 140);\n  }\n\n  if (h > 400) {\n    xc.css({\n      width: w - 20 + 'px',\n      height: h - 140 + 'px'\n    });\n    sc.css({\n      width: w - 20 + 'px',\n      height: 30 + 'px'\n\n    });\n  } else {\n    var nw = Math.floor(w * .70);\n    xc.css({\n      width: nw + 'px',\n      height: h - 110 + 'px'\n    });\n    sc.css({\n      width: nw + 'px'\n\n    });\n\n  }\n  canvasElement.height = h - 140;\n  canvasElement.width = w;\n  if ($('#debug').slider().val() === \"1\") {\n    alert(\" Resize \" + w + \" x \" + h + \" debug \" + $('#debug').slider().val());\n  }\n\n  if (darworms.theGame) {\n    setScale(this.grid.width, this.grid.height);\n    darworms.theGame.needsRedraw = true;\n    clearCanvas();\n    drawCells();\n  }\n}\n","// scorecanvas.js\nimport {\n  Point\n} from \"./Point.js\";\nimport {\n  darworms\n} from \"./loader.js\";\n\nvar scoreCanvas;\nexport var scorectx;\n\nexport function scoreCanvasInit(game) {\n  scoreCanvas = document.getElementById(\"scorecanvas\");\n  scorectx = scoreCanvas.getContext(\"2d\");\n  scorectx.font = \"bold 18px sans-serif\";\n  scorectx.shadowColor = \"rgb(190, 190, 190)\";\n  scorectx.shadowOffsetX = 3;\n  scorectx.shadowOffsetY = 3;\n}\n\nexport function clearScore(segmentIndex, totalSegments) {\n  var segWidth = scoreCanvas.width / totalSegments;\n  scorectx.fillStyle = darworms.dwsettings.cellBackground[0];\n  scorectx.shadowOffsetX = 0;\n  scorectx.shadowOffsetY = 0;\n\n  scorectx.fillRect(segWidth * segmentIndex, 0, segWidth, scoreCanvas.height);\n}\n\n\n\nfunction scoreStartx(segmentIndex, totalSegments, text) {\n  var segWidth = scoreCanvas.width / totalSegments;\n  var twidth = scorectx.measureText(text).width;\n  return ((segWidth * segmentIndex) + (segWidth / 2) - (twidth / 2));\n\n}\n\nexport function updateScores(wormArray) {\n  var i;\n\n  wormArray.forEach(function(aworm, i) {\n    if (aworm !== undefined && aworm.shouldDrawScore()) {\n      clearScore(i, 4);\n      scorectx.fillStyle = darworms.dwsettings.colorTable[i + 1];\n      // scorectx.shadowOffsetX = 3;\n      // scorectx.shadowOffsetY = 3;\n      scorectx.fillText(aworm.score, scoreStartx(i, 4, aworm.score.toString()), 15);\n    }\n  })\n  // for (i = 0; i < 4; i++) {\n  //   if (aworm !== undefined && shouldDrawScore.shouldDrawScore()) {\n  //      clearScore(i, 4);\n  //      scorectx.fillStyle = darworms.dwsettings.colorTable[i + 1];\n  // scorectx.shadowOffsetX = 3;\n  // scorectx.shadowOffsetY = 3;\n  //      scorectx.fillText(aworm.score, scoreStartx(i, 4, aworm.score.toString()), 15);\n  //    }\n};\n","// gameio.js\nimport {\n  updateScores\n} from \"./scorecanvas.js\";\nimport {\n  log\n} from \"./utils.js\"\n\n\n\nlet jsongame = {\n\n}\n\nlet dworm = {\n  name: \"\",\n  index: 0,\n}\n\nlet gameObj = {};\nlet gameTxt = \"\";\nlet gameUrl = \"\";\n\n\nfunction pick(o, ...fields) {\n  return fields.reduce((a, x) => {\n    if (o.hasOwnProperty(x)) a[x] = o[x];\n    return a;\n  }, {});\n}\n\nfunction addPick(a, o, ...fields) {\n  return Object.assign(a, pick(o, ...fields))\n}\n\nfunction gameName(game) {\n  const then = new Date(game.createdAt);\n  var name = then.toString();\n  let nplayers = 0;\n  game.players.forEach(function(aworm, i) {\n    if (aworm.typeName !== \" None \") nplayers++;\n  });\n  name = name.substr(0, name.indexOf('GMT'));\n  name += '[' + game.width + 'x' + game.width + ': ' + nplayers;\n  name += (nplayers == 1) ? ' player]' : ' players]';\n  return name;\n}\nexport function emailGame(gameText) {\n  var mailtourl = \"mailto:?subject=\" +\n    encodeURIComponent(\"Darworms Game \") +\n    \"&body=\" +\n    encodeURIComponent(\"Darworms is a unique, free web strategy territoty capture game. Select everything below and paste it into a browser address bar \\n\\n\") +\n    // encodeURIComponent(\"Here is an example of a game I played: \\n\") +\n\n    encodeURIComponent(darworms.host) +\n    encodeURIComponent(\"?darwormsgame=\") +\n    encodeURIComponent(gameText);\n  log(\"url: \" + mailtourl);\n  // document.location.href = mailtourl;\n  window.open(mailtourl);\n\n}\nexport function encodeGame(game, settings, graphics, version) {\n  log(\" encodeGame 0 \");\n  now = new Date();\n  gameObj = {\n    version: version\n  };\n  gameObj.createdAt = now.valueOf();\n  gameObj = addPick(gameObj, game, \"numMoves\", \"numTurns\");\n  gameObj = addPick(gameObj, game.grid, \"width\");\n  gameObj = addPick(gameObj, settings, \"backGroundTheme\", \"doAnimations\",\n    \"doAudio\", \"gridGeometry\", \"fixedInitPos\", \"pickDirectionUI\", \"masterAudioVolume\");\n  gameObj = addPick(gameObj, graphics, \"fps\");\n\n  gameObj.players = [];\n  game.worms.forEach(function(aworm, i) {\n    var wrm = {\n      index: i\n    };\n    // new dna may have been set in this game\n    aworm.toText();\n    wrm = addPick(wrm, aworm, \"typeName\", \"startingPos\", \"name\", \"score\", \"instrument\", \"musickeyName\", \"MusicScale\");\n    gameObj.players.push(wrm);\n  });\n\n  gameTxt = JSON.stringify(gameObj);\n  gameUrl = encodeURIComponent(gameTxt)\n  let testOne = decodeURIComponent(gameUrl);\n  let testTwo = JSON.parse(testOne);\n  let testThree = JSON.stringify(testTwo);\n  log(\"before: \" + gameTxt);\n  log(\"after:  \" + testThree);\n  return (gameTxt)\n\n}\n\nexport function decodeGame(gameTxt) {\n  log(\" decodeGame \");\n  let gameObj = JSON.parse(gameTxt);\n  darworms.dwsettings.gridGeometry = gameObj.gridGeometry;\n  darworms.main.setupGridGeometry();\n}\n\nexport function loadGames() {\n\n  const data = JSON.parse(localStorage.getItem('darwormgames'))\n  darworms.savedgames = data || [];\n  let gameindex = 0;\n\n  darworms.savedgames.forEach(function(gameTxt, i) {\n    const gameObj = JSON.parse(gameTxt);\n    const then = new Date(gameObj.createdAt);\n    /* const elementStr = '<li> <button data-role=\"button\" data-inline=\"false\"  data-theme=\"a\" lass=\"ui-btn ui-shadow ui-corner-all\"> ' +\n    then.toTimeString() +\n     '</button></li>';\n    $('#savedgames')[0].appendChild(elementStr).trigger('create');\n*/\n    const liStr = '<li data-icon=\"delete\" data-split-icon=\"delete-black\"><a class=\"loadMe\" value=' + i + '>' + gameName(gameObj) + '</a><a value=' +\n      i + ' data-icon=\"star\" data-split-icon=\"delete-black\" class=\"deleteMe\" ></a></li>'\n    $('#savedgames').append(liStr).listview('refresh');\n\n    //    $('#savedgames').append(liStr).trigger('create');\n    //    $('#savedgames').append('<li id=\"l1\"><a>5.00</a><a id=\"1\" class=\"deleteMe\"></a></li>').trigger('create');\n    log(\" liStr: \" + liStr);\n\n\n  })\n  $('.deleteMe').on('click', function(event) {\n    log(\" deleteMe clicked\");\n    log($(this).attr(\"value\"));\n    let index = parseInt($(this).attr(\"value\"))\n    if ((index >= 0) && (index < darworms.savedgames.length)) {\n      darworms.savedgames.splice(index, 1);\n    }\n    localStorage.setItem('darwormgames', JSON.stringify(darworms.savedgames));\n    refreshSavedGames();\n  });\n  $('.loadMe').on('click', function(event) {\n    log(\" loadMe clicked\");\n    log($(this).attr(\"value\"));\n    let index = parseInt($(this).attr(\"value\"))\n    if ((index >= 0) && (index < darworms.savedgames.length)) {\n      let gameObj = darworms.main.injectSettings(darworms.savedgames[index]);\n      updateScores(darworms.main.gWorms);\n      $.mobile.changePage('#playpage');\n    }\n\n  });\n}\n\nexport function freeGames() {\n  const svgamelist = $('#savedgames')[0];\n  while (svgamelist.firstChild) {\n    svgamelist.removeChild(svgamelist.firstChild)\n  }\n}\n\nexport function saveGame(gameTxt) {\n  log(\" saveGame \");\n  darworms.savedgames.push(gameTxt);\n  localStorage.setItem('darwormgames', JSON.stringify(darworms.savedgames));\n  refreshSavedGames();\n\n}\n\nexport function loadGame() {\n  log(\" loadGame \");\n  const data = JSON.parse(localStorage.getItem('darwormgames'));\n}\n\nfunction refreshSavedGames() {\n  const svgamelist = $('#savedgames')[0];\n  while (svgamelist.firstChild) {\n    svgamelist.removeChild(svgamelist.firstChild)\n  }\n  loadGames();\n}\n","//  Game.js\nimport {\n  Point\n} from \"./Point.js\";\nimport {\n  darworms\n} from \"./loader.js\";\nimport {\n  Grid\n} from \"./Grid.js\";\nimport {\n  drawdna\n} from \"./drawdna.js\";\nimport {\n  getOffset,\n  gsetTranslate,\n  setGrid\n} from \"./graphics.js\"\nimport {\n  wCanvas,\n  setScale,\n  scale,\n  drawcell,\n  showTimes,\n  frameTimes,\n  startFrameTimes,\n  startGameTimer,\n  stopGameTimer,\n  highlightWorm,\n  drawPickCell,\n  drawPickCellOrigin,\n  drawExpandedTarget,\n  drawPickCells,\n  drawCells,\n  graphicsInit,\n  drawDirtyCells,\n  pushDirtyCell,\n  animateDyingWorms,\n  clearCanvas,\n  initPickUI,\n  selectDirection\n} from \"./graphics.js\";\n\nimport {\n  scoreCanvasInit,\n  clearScore,\n  updateScores\n} from \"./scorecanvas.js\";\n\nimport {\n  encodeGame,\n  decodeGame,\n} from \"./gameio.js\"\n\nimport {\n  log\n} from \"./utils.js\"\n\n/**\n * Created with JetBrains WebStorm.\n * User: dmaynard\n * Date: 9/22/13\n * Time: 12:15 AM\n * To change this template use File | Settings | File Templates.\n */\n\n// This module needs to separated into separate  UI(graphics) and game logic modules\n\nvar nextToMove;\nvar focusPoint;\nvar focusWorm\n\n// the jump from full pan left (-1.0) to full pan right (+1.0)\n// is too jaring. This limits pan to [-.8 , +.8]\n// Could be a setting  (pan effect 0 - 1)\nconst maxpan = 0.8;\n\nexport class Game {\n  constructor(gridWidth, gridHeight) {\n\n    wCanvas.width = $('#wcanvas').width();\n    wCanvas.height = $('#wcanvas').height()\n\n\n    this.gameState = darworms.gameStates.over;\n    this.grid = new Grid(gridWidth, gridHeight);\n    setGrid(this.grid, this);\n\n    this.numTurns = 0;\n    this.numMoves = 0;\n    this.activeIndex = 0;\n\n    setScale(gridWidth, gridHeight);\n    log(\" new Game scale set to \" + scale.format());\n    this.origin = new Point(gridWidth >> 1, gridHeight >> 1);\n    focusPoint = this.origin;\n    this.worms = [];\n    this.needsRedraw = true;\n    this.avePos = new Point(0, 0);\n    // worm index of zero means unclaimed.\n    this.focusWorm = null;\n    this.focusValure = null;\n\n    this.xPts = [1.0, 0.5, -0.5, -1.0, -0.5, 0.5];\n    this.yPts = [0.0, 1.0, 1.0, 0.0, -1.0, -1.0];\n\n    // variable for animating zoom in to selection UI\n    // create back buffer image  for current grid image\n\n    // this should depend on scale factor.  On small screens\n    // we cshould set pickDirectionUI to true\n    if ((scale.x) < 20 || (scale.y < 20)) {\n      $('#pickDirectionUI').slider().val(1);\n      $('#pickDirectionUI').slider(\"refresh\");\n      darworms.dwsettings.pickDirectionUI = 1;\n    }\n    log(\" Scale: \" + scale.format() + \"darworms.dwsettings.pickDirectionUI: \" + darworms.dwsettings.pickDirectionUI);\n    this.zoomFrame = 0;\n    this.startx = 0;\n    this.starty = 0;\n    this.endx = 0;\n    this.endy = 0;\n    this.startscale = 1.0;\n    this.endScale = 1.0;\n    // three second zoom animation\n    this.targetZoomFrames = 60;\n    this.asterixSize = 0.2;\n    this.bullseyeoffset = new Point(0, 0);\n    this.focusWorm = null;\n\n  }\n\n  updateScale(width, height) {\n    setScale(this.grid.width, this.grid.height);\n\n    log(\"updateScale \" + scale.format());\n  };\n\n  log() {\n\n    log(\" Game grid size  \" + new Point(this.grid.width, this.grid.height).format());\n    log(\" Game Canvas size  \" + new Point(wCanvas.width, wCanvas.height).format());\n    log(\" Game scale \" + scale.format());\n    for (var i = 0; i < this.worms.length; i = i + 1) {\n      log(\" Game worm \" + i + \" :  \" + this.worms[i].state + \" at \" + this.worms[i].pos.format() + \" value:\" + this.grid.hexValueAt(this.worms[i].pos));\n      // this.worms[i].log();\n      // log ( \"   Grid value =  \");\n      // this.grid.logValueAt(this.worms[i].pos);\n    }\n  };\n  printNonEmpty() {\n\n    this.grid.each(function(point, value) {\n      if (value > 0) {\n        log(\"NonEmpty \" + point.format() + \" value: 0x\" + value.toString(16));\n      }\n    });\n\n  };\n\n  /*  TODO  move all drawing from game to graphics.js\n\n   */\n\n\n  initGame() {\n    clearCanvas();\n    this.grid.clear();\n    setGrid(this.grid, this)\n    drawCells();\n    startGameTimer();\n    this.numMoves = 0;\n    this.numTurns = 0;\n    this.timeInDraw = 0;\n\n  };\n  addWorm(w) {\n    w.pos = this.origin;\n    w.nMoves = 0;\n    w.score = 0;\n    w.state = darworms.wormStates.paused;\n    this.worms.push(w);\n  };\n  getAvePos(w) {\n    var nActiveAve = 0;\n    this.avePos.x = 0;\n    this.avePos.y = 0;\n\n    for (var i = 0; i < this.worms.length; i = i + 1) {\n      var active = this.worms[i];\n      if (active.state === darworms.wormStates.moving) {\n        this.avePos.x = this.avePos.x + active.pos.x;\n        this.avePos.y = this.avePos.y + active.pos.y;\n        nActiveAve = nActiveAve + 1;\n      }\n    }\n\n    if (nActiveAve > 1) {\n      this.avePos.x = Math.floor(this.avePos.x / nActiveAve);\n      this.avePos.y = Math.floor(this.avePos.y / nActiveAve);\n    }\n    // log(this.avePos.format());\n  };\n\n  makeMove(graphicsOn) {\n    var nAlive = 0;\n    if (this.gameState === darworms.gameStates.waiting) {\n      return;\n    }\n    // log (\"Game  StartingTurn \" + this.numTurns );\n    for (var i = nextToMove; i < this.worms.length; i = i + 1) {\n      var active = this.worms[i];\n      darworms.theGame.activeIndex = i;\n      // log (\" GamemakeMove   for worm\" + i + \" :  \" + darwormd.wormStateNames[active.state] + \" at \"  + active.pos.format());\n      if (active.state === darworms.wormStates.sleeping) {\n        continue;\n      }\n      // active.state = darworms.wormStates.moving;\n      // log (\" Game  Before Move for worm\" + i + \" :  \" + active.state + \" at \"  + active.pos.format());\n      // active.log();\n      // log ( \"   Grid value =  \");\n      // this.grid.logValueAt(active.pos);\n      var currentState = this.grid.stateAt(active.pos);\n      // log (\" Current State = \" + currentState);\n      if (currentState == 0x3F) {\n        // last sample is death sound\n        if ((active.state != (darworms.wormStates.dead) && (active.state != darworms.wormStates.dying))) {\n          if (darworms.dwsettings.doAnimations) {\n            if ((darworms.dwsettings.doAudio == 1) && darworms.audioSamples[darworms.audioSamples.length - 1]) {\n              darworms.audioSamples[darworms.audioSamples.length - 1].playSample(1.0, 0.0);\n            }\n          }\n          active.state = (darworms.dwsettings.doAnimations) ? darworms.wormStates.dying : darworms.wormStates.dead;\n          active.diedAtFrame = darworms.graphics.uiFrames;\n          log(\" darworm \" + active.colorIndex + \" dying at frame: \" + darworms.graphics.animFrame);\n        }\n\n        if (active.state == darworms.wormStates.dying) {\n          if ((darworms.graphics.uiFrames - active.diedAtFrame) > darworms.graphics.dyningAnimationFrames) {\n            active.state = darworms.wormStates.dead;\n            log(\" darworm \" + active.colorIndex + \" dead at frame: \" + darworms.graphics.animFrame);\n          }\n        }\n\n      } else {\n        var direction = active.getMoveDir(currentState);\n        if (direction === darworms.dwsettings.codons.unSet) {\n          this.gameState = darworms.gameStates.waiting;\n          // log(\" setting gamestate to  \" + this.gameState);\n          focusPoint = active.pos;\n          focusWorm = active;\n          darworms.theGame.focusWorm = active;\n          darworms.theGame.focusValue = currentState;\n          if (darworms.theGame.focusWorm.showTutorial) {\n            $(\"input[type='checkbox']\").attr(\"checked\", false);\n            var btns = ['#p1button', '#p2button', '#p3buton', '#p4button'];\n            // ToDo  set proper theme for popup   red green blue ye\n            // Setter\n            // $('#tutorialpopup' ).popup( \"option\", \"overlayTheme\", \"d\" );\n            $('#tutorialpopup').popup(\"option\", \"theme\", darworms.themes[darworms.theGame.activeIndex]);\n            // this makes the popup background transparent, but it looks reall bad\n            // $('#tutorialpopup').popup( \"option\",\"theme\", 'none' );\n            log(\" init popup here\");\n            drawdna(document.getElementById('popupcanvas'), active, currentState);\n            $('#tutorialpopup').popup(\"open\", {\n              positionTo: btns[darworms.theGame.activeIndex]\n            });\n          }\n          nextToMove = i;\n          this.numMoves = this.numMoves + 1;\n          active.nMoves = active.nMoves + 1;\n          drawDirtyCells();\n          initPickUI(active);\n          return (true);\n        }\n        if (true || graphicsOn) {\n          pushDirtyCell(active.pos);\n        }\n        // log (\" Move Direction = \" + direction);\n        var next = this.grid.next(active.pos, direction);\n        if (next.isEqualTo(darworms.dwsettings.noWhere)) { // fell of edge of world\n          active.state = darworms.wormStates.dead;\n          active.died = true;\n        } else {\n          var didScore = this.grid.move(active.pos, next, direction, active.colorIndex);\n          active.score = active.score + didScore;\n          this.numMoves = this.numMoves + 1;\n          active.nMoves = active.nMoves + 1;\n          // log(\"    Worm \" + active.colorIndex + \"  just made move \" + active.nMoves + \" game turn \" + this.numTurns + \" From \" + this.grid.formatStateAt(active.pos) + \" direction  \" + direction);\n          active.pos = next;\n\n          if (true || graphicsOn) {\n            pushDirtyCell(next);\n            if (darworms.dwsettings.doAudio == 1 && graphicsOn) {\n              let panValue = maxpan * ((active.pos.x - (darworms.theGame.grid.width / 2)) / (darworms.theGame.grid.width / 2));\n              if ((active.audioSamplesPtrs[direction] !== undefined) && (active.audioSamplesPtrs[direction] >= 0)) {\n                darworms.audioSamples[active.audioSamplesPtrs[direction]].\n                playSample(\n                  darworms.audioPlaybackRates[active.MusicScale[(didScore == 1) ? 6 : direction]],\n                  panValue);\n              }\n            }\n\n          }\n\n          // log(\" active.score [\" +  i + \"] =\"  + active.score);\n\n          //log(\"     From Value is \" +  this.grid.hexValueAt(active.pos)  );\n          //log (\" Next Point = \" + next.format());\n          //log(\" Set To State to \" +  this.grid.stateAt(active.pos)  );\n          //log(\"     To Value is \" +  this.grid.hexValueAt(active.pos)  );\n        }\n\n      }\n      if ((active.state !== darworms.wormStates.dead)) {\n        nAlive = nAlive + 1;\n      }\n      //log (\" Game  After Move for worm\" + i + \" :  \" + active.state + \" at \"  + active.pos.format());\n      // this.grid.logValueAt(active.pos);\n    }\n    nextToMove = 0;\n    this.numTurns = this.numTurns + 1;\n    return (nAlive > 0 || (nextToMove !== 0));\n  };\n\n\n\n\n  // Converts canvas to an image\n  convertCanvasToImage(canvas) {\n    var image = new Image();\n    image.src = canvas.toDataURL(\"image/png\");\n    return image;\n  }\n}\n\nexport function binToRGB(bin) {\n  return {\n    r: parseInt(((bin >> 16) & 0xFF)),\n    g: parseInt(((bin >> 8) & 0xFF)),\n    b: parseInt(((bin) & 0xFF))\n  };\n}\n\n// end of Module prototypes\n\n//  Called from Timer Loop\n\nfunction makeMoves() {\n  // log(\" makeMoves theGameOver \" + theGameOver +  \"  gameState \" + gameStateNames[theGame.gameState] );\n  var startTime = new Date().getTime();\n  startFrameTimes.push(startTime);\n  if (darworms.theGame.needsRedraw) {\n    drawCells();\n    darworms.theGame.needsRedraw = false;\n  }\n  if (darworms.theGame.gameState != darworms.gameStates.over) {\n    if (darworms.theGame.makeMove(darworms.dwsettings.doAnimations) === false) {\n      stopGameTimer();\n      log(\" Game Over\");\n      clearInterval(darworms.graphics.timer);\n      // document.getElementById(\"startpause\").innerHTML = \"Start Game\";\n      $(\"#startpause\").text(\"Start Game\");\n      showTimes();\n      updateScores(darworms.theGame.worms);\n      darworms.theGame.gameState = darworms.gameStates.over;\n      darworms.gameTxt = encodeGame( darworms.theGame, darworms.dwsettings, darworms.graphics, darworms.version);\n      // decodeGame(gameTxt);\n      // darworms.main.injectSettings(gameTxt);\n    }\n  }\n  if (darworms.dwsettings.doAnimations) {\n    drawDirtyCells();\n    animateDyingWorms();\n    darworms.theGame.getAvePos();\n  }\n  updateScores(darworms.theGame.worms);\n  var elapsed = new Date().getTime() - startTime;\n  frameTimes.push(elapsed);\n};\n// Called from user actions\n\n\nfunction gameInit() {\n  // used to initialize variables in this module's closure\n  log(\" wCanvas,width: \" + wCanvas.width);\n  graphicsInit(this);\n  scoreCanvasInit();\n  nextToMove = 0;\n\n}\n\nexport {\n  gameInit,\n  reScale,\n  makeMoves,\n  selectDirection,\n  updateScores\n}\n/* end of Game */\n","/**\n * Created with JetBrains WebStorm.\n * User: dmaynard\n * Date: 9/21/13\n * Time: 11:37 PM\n */\n\n import {\n   log\n } from \"./utils.js\"\n \nexport class  Point {\n  constructor(x,y) {\n    const privateString = \"(\" + x + \",\" + y + \")\";\n    this.x = x;\n    this.y = y;\n  }\n  isEqualTo (other) {\n      return this.x == other.x && this.y == other.y;\n  };\n  add (other) {\n  //    log (\" adding (\" + other.x + \",\" + other.y + \" to (\" + this.x + \",\" + this.y );\n      this.x = this.x + other.x;\n      this.y = this.y + other.y;\n    }\n  dist(other) {\n        //  log (\" dist from (\" + other.x + \",\" + other.y + \") to (\" + this.x + \",\" + this.y );\n        return Math.sqrt((this.x - other.x ) * (this.x - other.x) +  (this.y - other.y) * (this.y - other.y));\n    }\n  absDiff (other) {\n        //  log (\" dist from (\" + other.x + \",\" + other.y + \") to (\" + this.x + \",\" + this.y );\n        return new Point( Math.abs(this.x-other.x) , Math.abs(this.y-other.y));\n    }\n  wrap (wg, hg) {\n        if (this.x >= wg) this.x = this.x - wg;\n        if (this.x < 0) this.x = this.x + wg;\n        if (this.y >= hg) this.y = this.y - hg;\n        if (this.y < 0) {\n            this.y = this.y + hg;\n        }\n    };\n\n    format ( ) {\n        return \"(\" + this.x + \",\" + this.y + \")\";\n    };\n\n    print ( ) {\n      log ( \" Private class variable \" + privateString);\n    }\n}\n","import { Point } from \"./Point.js\";\nimport {\n  log\n} from \"./utils.js\"\n\nexport var darworms = {\n  version: \"0.9.3\",\n  // host: \"localhost:5000\",\n  host: \"https://darworms.com\",\n  compassPts: [\"e\", \"se\", \"sw\", \"w\", \"nw\", \"ne\", \"unSet\", \"isTrapped\"],\n  gameStates: {\n    \"over\": 0,\n    \"running\": 1,\n    \"waiting\": 2,\n    \"paused\": 3,\n    \"animToUI\": 4,\n    \"animFromUI\": 5\n  },\n  wormStates: {\n    \"dead\": 0,\n    \"moving\": 1,\n    \"paused\": 2,\n    \"sleeping\": 3,\n    \"dying\": 4 //  dead but let the game keep going for a few frames to animate\n  },\n  wormStateNames: [\"dead\", \"moving\", \"paused\", \"sleeping\", \"dying\"],\n  initialWormStates: [3, 2, 2, 2],\n  themes: [\"c\", \"d\", \"e\", \"f\"],\n  selectedIdx: 0,\n  gameStateNames: [\"over\", \"running\", \"waiting\", \"paused\", \"to_ui\", \"from_ui\"],\n  outMask: [1, 2, 4, 8, 16, 32],\n  inMask: [8, 16, 32, 1, 2, 4],\n  colorNames: ['red', 'green', 'blue', 'yellow'],\n  buttonSelectors: ['#p1button', '#p2button', '#p3button', '#p4button'],\n  buttonLSelectors: ['#p1Lbutton', '#p2Lbutton', '#p3Lbutton', '#p4Lbutton'],\n  inDir: [3, 4, 5, 0, 1, 2],\n  wCanvasPixelDim: [0, 0],\n  wCanvasRef: undefined,\n  minTwoColumnWidth: 480,\n  leftColumnWidth: 320,\n  screens: {},\n  pickCells: [],\n  graphics: {\n    timer: undefined,\n    scorectx: undefined,\n    animFrame: 0,\n    uiFrames: 0,\n    rawFrameCount: 0,\n    drawFrameCount: 0,\n    uiFrameCount: 0,\n    xPts: [0.5, 0.25, -0.25, -0.5, -0.25, 0.25],\n    yPts: [0.0, 0.5, 0.5, 0.0, -0.5, -0.5],\n    fps: 4,  //  initial frame rate\n    frameInterval: 33.33333,\n    uifps: 30,\n    uiInterval: 33.33333,\n    startTime: 0,\n    now: 0,\n    then: 0,\n    uiThen: 0,\n    elapsed: 0,\n    uiElapsed: 0,\n    vertex_x: [0.5, 0.5, 0, -0.5, -0.5, 0],\n    vertex_fudge: 0.12,\n    vertex_y: [0.3125, -0.3125, -0.6875, -0.3125, 0.3125, 0.6875],\n    hexSize: 1.0,\n    sqrt3: Math.sqrt(3),\n    dyningAnimationFrames: 8\n\n  },\n  selectedDarworm: 0,\n  notes: {\n    C1: 0,\n    CS: 1,\n    DF: 1,\n    D: 2,\n    DS: 3,\n    EF: 3,\n    E: 4,\n    F: 5,\n    FS: 6,\n    GF: 6,\n    G: 7,\n    GS: 8,\n    FF: 8,\n    AF: 8,\n    A: 9,\n    AS: 10,\n    BF: 10,\n    B: 11,\n    C2: 12\n  },\n\n  dwsettings: {   //  User adjustable settings\n    forceInitialGridSize: true,\n    largeGridSize: 18, // The original Atari 800 Character mode\n    smallGridSize: 10, // so cells can be selected with touch\n    tinyGridSize: 8,\n\n    minLargeScreenWidth: 800, //\n    maxSmallSreenWidth: 500,\n    isLargeScreen: true,\n    doAudio: 1,\n    fixedInitPos: true,\n    pickDirectionUI: 0,\n    noWhere: undefined,\n    gridGeometry: \"torus\",\n    codons: {\n      \"e\": 0,\n      \"ne\": 1,\n      \"nw\": 2,\n      \"w\": 3,\n      \"sw\": 4,\n      \"se\": 5,\n      \"unSet\": 6,\n      \"isTrapped\": 7\n    },\n    colorTable: [\"#000000\", \"#EE0000\", \"#00EE00\", \"#0404EE\",\n      \"#D0A000\", \"#448833\", \"#443388\", \"#338844\",\n      \"#FF1C0A\", \"#1CFF0A\", \"#1C0AFF\", \"#0AFF1C\",\n      \"#884433\", \"#448833\", \"#443388\", \"#338844\"\n    ],\n    alphaColorTable: [\"rgba(  0,   0,   0, 0.2)\",\n      \"rgba(  238,   0,   0, 0.4)\", \"rgba(    0, 128,   0, 0.4)\", \"rgba(    0,   0, 238, 0.4)\", \"rgba(  200, 200, 0, 0.4)\",\n      \"#FFD70080\", \"#5fa40480\", \"#44338880\", \"#33884480\",\n      \"#FF1C0A80\", \"#1CFF0A80\", \"#1C0AFF80\", \"#0AFF1C80\",\n      \"#88443380\", \"#44883380\", \"#44338880\", \"#33884480\"\n    ],\n    backGroundTheme: 0,\n    doAnimations: true,\n    gridBackground: [\"#F5F5F5\", \"#404040\"],\n    cellBackground: [\"#F5F5F5\", \"#404040\"],\n    masterAudioVolume: 0.3,\n    // Note  env is set by the rollup-plugin-replace at build time\n    dologging: ENV,\n    gridSize: 18\n  },\n  images: {},\n  audioContext: undefined,\n  masterGainNode: undefined,\n\n  audioPanner: undefined,\n  audioSamples: [],\n  // an array of 12 playback rates ranging from 0.5 to 1.0\n  // this gives 12 notes from an octave in an equal tempered scale.\n  audioPlaybackRates: [],\n  audioFrequencies: [],\n  gameTxt: null\n  // gameTxt: '{\"version\":\"0.9.1\",\"createdAt\":\"Fri May 10 2019 21:33:43 GMT-0700 (Pacific Daylight Time)\",\"numMoves\":263,\"numTurns\":83,\"width\":10,\"backGroundTheme\":\"1\",\"doAnimations\":true,\"doAudio\":\"1\",\"gridGeometry\":\"torus\",\"fixedInitPos\":\"1\",\"pickDirectionUI\":\"0\",\"masterAudioVolume\":0.3,\"fps\":\"30\",\"players\":[{\"index\":0,\"typeName\":\"Random\",\"startingPos\":{\"x\":5,\"y\":5},\"name\":\"FBFEBEEDCBFFEFFFDDDCFDADBFFFABFFBBDCBBAECEAEAEAEDCADBDADACACBBAX\",\"score\":14,\"instrument\":0,\"musickeyName\":\"CMajor\",\"MusicScale\":[0,2,4,5,7,9,11]},{\"index\":1,\"typeName\":\"Random\",\"startingPos\":{\"x\":5,\"y\":5},\"name\":\"DCEEADEEEBCFEFFEFBCDBFFFFBFFAFFFBDADAEADBEAEABAECDDDADDDBBACABAX\",\"score\":13,\"instrument\":0,\"musickeyName\":\"CMajor\",\"MusicScale\":[0,2,4,5,7,9,11]},{\"index\":2,\"typeName\":\"Random\",\"startingPos\":{\"x\":5,\"y\":5},\"name\":\"BCFDEDEECBACFBAFCCDCDFADCCCFABAFDEDEEDADBECCEEEEABDDBBADCBCCABAX\",\"score\":22,\"instrument\":0,\"musickeyName\":\"CMajor\",\"MusicScale\":[0,2,4,5,7,9,11]},{\"index\":3,\"typeName\":\"Random\",\"startingPos\":{\"x\":5,\"y\":5},\"name\":\"AEDCFDFDECAEEBEFCFFDFFDDFBFFBFAFDBEEAEADEEACAEAEADADBBADBCACABAX\",\"score\":17,\"instrument\":0,\"musickeyName\":\"CMajor\",\"MusicScale\":[0,2,4,5,7,9,11]}]}'\n};\n\nwindow.addEventListener(\"load\", function() {\n    // log(\" stage 1 loading finished\");\n    window.onerror = function(msg, url, line) {\n      alert(msg + \" \" + url + \" \" + line);\n    }\n    $(\"[data-darworm='selector']\").on('pageshow', darworms.main.setupEditPage);\n    $(\"[data-darworm='selector']\").on('pagehide', darworms.main.setSelectedDarwormType);\n    $(\"#settingspage\").on('pageshow', darworms.main.showSettings);\n    $(\"#settingspage\").on('pagebeforeshow', darworms.main.setupGridGeometry);\n    $(\"#settingspage\").on('pagehide', darworms.main.applySettings);\n    $(\"#playpage\").on('pageshow', darworms.main.initPlayPage);\n    $(\"#playpage\").on('pagehide', darworms.main.leavePlayPage);\n    $(\"#edit-darworm-page\").on('pageshow', darworms.main.initEditPage);\n    $(\"#edit-darworm-page\").on('pagehide', darworms.main.leaveditPage);\n    $(\"#loadsavepage\").on('pageshow', darworms.main.loadSavedGames);\n    $(\"#loadsavepage\").on('pagehide', darworms.main.freeSavedGames);\n\n    $( \"#tutorialpopup\" ).popup({\n        afterclose: function( event, ui ) {\n          log(\" afterclose even fired\" + $('#tutorialpopup input[type=checkbox]').prop(\"checked\"));\n          if ( $('#tutorialpopup input[type=checkbox]').prop(\"checked\") ) {\n            darworms.theGame.focusWorm.showTutorial = false;\n          }\n        }\n    });\n    log(\"About to call darworms.main.init()\");\n    window.darworms = darworms;  // So index.html onclick can find handlers\n    darworms.main.init();\n\n  }\n\n);\n","import { Point } from \"./Point.js\";\nimport { darworms } from \"./loader.js\";\nimport {\n  log\n} from \"./utils.js\"\n/**\n * Created with JetBrains WebStorm.\n * User: dmaynard\n * Date: 9/21/13\n * Time: 11:57 PM\n * To change this template use File | Settings | File Templates.\n */\n/*    Grid   */\n\n  const evenRowVec = [ {x: 1,y: 0}, {x: 0,y: 1}, {x:-1,y: 1},\n                       {x:-1,y: 0}, {x:-1,y:-1}, {x: 0,y:-1}]\n\n  const oddRowVec = [ {x: 1,y: 0}, {x: 1,y: 1}, {x:0,y: 1},\n                      {x:-1,y: 0}, {x: 0,y:-1}, {x: 1,y:-1}]\n\n  //  although we reserve 4 bits for each direction we actually only use 3 bits\n  const spokeMask = [0xFFFFFFF0,\n    0xFFFFFF0F,\n    0xFFFFF0FF,\n    0xFFFF0FFF,\n    0xFFF0FFFF,\n    0xFF0FFFFF,\n    0xF0FFFFFF,\n    0x0FFFFFFF\n  ];\n  // sink mask is high bit of spoke 6\n  const sinkMask = 0x08000000;\n\n  export class  Grid {\n  constructor (width, height) {\n    this.width = Math.floor(width);\n    this.height = Math.floor(height);\n\n    //  Cell Format   8 bits each:  in-spoke eaten, out-spoke eaten, spoke eaten\n    this.cells = new Array(width * height);\n\n    //  7 * 4 bits of color index info for color of each spoke and center\n    this.colors = new Array(width * height);\n    this.clear();\n  }\n\n  clear () {\n    for (var i = 0; i < this.cells.length; i++) this.cells[i] = 0;\n    for (var i = 0; i < this.colors.length; i++) this.colors[i] = 0;\n    // We implement reflecting at grid edges by\n    // filling all of the spokes that would leave\n    // the grid or wrap\n    if (darworms.dwsettings.gridGeometry == 'reflect') {\n      for (var i = 0; i < this.width; i = i + 1) {\n        var topPoint = new Point(i, 0);\n        var botPoint = new Point(i, this.height - 1);\n\n        this.setValueAt(topPoint, this.valueAt(topPoint) | darworms.outMask[4] | darworms.outMask[5]); // block up\n        this.setValueAt(topPoint, this.valueAt(topPoint) | ((this.valueAt(topPoint) & 0x3F) << 8)); // set outvec\n        this.setSpokeAt(topPoint, 4, 0);\n        this.setSpokeAt(topPoint, 5, 0);\n        this.setSpokeAt(topPoint, 6, 0);\n        this.setValueAt(botPoint, this.valueAt(botPoint) | darworms.outMask[1] | darworms.outMask[2]); // block down\n        this.setValueAt(botPoint, this.valueAt(botPoint) | ((this.valueAt(botPoint) & 0x3F) << 8)); // set outvecs\n        this.setSpokeAt(botPoint, 1, 0);\n        this.setSpokeAt(botPoint, 2, 0);\n        this.setSpokeAt(botPoint, 6, 0);\n\n      }\n      for (var j = 0; j < this.height; j = j + 1) {\n        var leftPoint = new Point(0, j);\n        var rightPoint = new Point(this.width - 1, j);\n\n        if ((j & 1) == 0) { // even rows shifted left 1/2 cell\n          this.setValueAt(leftPoint, this.valueAt(leftPoint) | darworms.outMask[2] | darworms.outMask[3] | darworms.outMask[4]); // block left\n          this.setValueAt(leftPoint, this.valueAt(leftPoint) | ((this.valueAt(leftPoint) & 0x3F) << 8)); // set outvecs\n          this.setSpokeAt(leftPoint, 2, 0);\n          this.setSpokeAt(leftPoint, 3, 0);\n          this.setSpokeAt(leftPoint, 4, 0);\n          this.setSpokeAt(leftPoint, 6, 0);\n          this.setValueAt(rightPoint, this.valueAt(rightPoint) | darworms.outMask[0]); //block right\n          this.setValueAt(rightPoint, this.valueAt(rightPoint) | ((this.valueAt(rightPoint) & 0x3F) << 8)); // set outvecs\n          this.setSpokeAt(rightPoint, 0, 0);\n          this.setSpokeAt(rightPoint, 6, 0);\n        } else { // odd rows shifted right on cell\n          this.setValueAt(leftPoint, this.valueAt(leftPoint) | darworms.outMask[3]); // block left\n          this.setValueAt(leftPoint, this.valueAt(leftPoint) | ((this.valueAt(leftPoint) & 0x3F) << 8)); // set outvecs\n          this.setSpokeAt(leftPoint, 3, 0);\n          this.setSpokeAt(leftPoint, 6, 0);\n          this.setValueAt(rightPoint, this.valueAt(rightPoint) | darworms.outMask[5] | darworms.outMask[0] | darworms.outMask[1]); //block right\n          this.setValueAt(rightPoint, this.valueAt(rightPoint) | ((this.valueAt(rightPoint) & 0x3F) << 8)); // set outvecs\n          this.setSpokeAt(rightPoint, 5, 0);\n          this.setSpokeAt(rightPoint, 0, 0);\n          this.setSpokeAt(rightPoint, 1, 0);\n          this.setSpokeAt(rightPoint, 6, 0);\n        }\n      }\n    }\n  };\n  valueAt (point) {\n    return this.cells[point.y * this.width + point.x];\n  };\n  hexValueAt (point) {\n    return (\" 0x\" + (this.valueAt(point)).toString(16));\n  };\n  stateAt (point) {\n    return this.valueAt(point) & 0x3F;\n  };\n  outVectorsAt (point) {\n    return (this.valueAt(point) >> 8) & 0x3F;\n  };\n  inVectorsAt (point) {\n    return (this.valueAt(point) >> 16) & 0x3F;\n  };\n  spokeAt (point, dir) {\n    return (this.colors[point.y * this.width + point.x] >>> (dir * 4)) & 0x07;\n  };\n  colorsAt (point) {\n    return (this.colors[point.y * this.width + point.x]);\n  }\n\n  setSpokeAt (point, dir, colorIndex) {\n    this.colors[point.y * this.width + point.x] =\n      ((this.colors[point.y * this.width + point.x]) & spokeMask[dir]) |\n      ((colorIndex & 0x0F) << (dir * 4));\n\n  };\n  setValueAt (point, value) {\n    this.cells[point.y * this.width + point.x] = value;\n  };\n\n  setSinkAt (point) {\n    this.cells[point.y * this.width + point.x] =\n        (this.cells[point.y * this.width + point.x] ^ sinkMask);\n  };\n\n  isSink (point) {\n    return ( (this.cells[point.y * this.width + point.x] & sinkMask) !== 0);\n  };\n\n  isInside (point) {\n    return point.x >= 0 && point.y >= 0 &&\n      point.x < this.width && point.y < this.height;\n  };\n  move (from, to, dir, colorIndex) {\n    if ((this.inVectorsAt(to) & darworms.inMask[dir]) !== 0) {\n      alert(\" Attempted to eat eaten spoke at \" + to.format());\n      log(\"  (\" + to.x + \",\" + to.y + \") dir: \" + dir + \" value: \");\n      log(\"Attempted to eat eaten spoke at \" + to.format() + \" dir \" + dir + \" value: 0x\" + this.valueAt(to).toString(16));\n    }\n    this.setValueAt(to, this.valueAt(to) | darworms.inMask[dir] | (darworms.inMask[dir] << 16));\n    this.setValueAt(from, this.valueAt(from) | darworms.outMask[dir] | (darworms.outMask[dir] << 8));\n    this.setSpokeAt(from, dir, colorIndex);\n    this.setSpokeAt(from, 6, colorIndex);\n    this.setSpokeAt(to, darworms.inDir[dir], colorIndex);\n    this.setSpokeAt(to, 6, colorIndex);\n    var captures = 0;\n    if (this.stateAt(to) === 0x3f) {\n      this.setSpokeAt(to, 6, colorIndex);\n      this.setSpokeAt(to, 7, colorIndex);\n\n      captures = captures + 1;\n    }\n    if (this.stateAt(from) === 0x3f) {\n      this.setSpokeAt(from, 6, colorIndex);\n      this.setSpokeAt(from, 7, colorIndex);\n\n      captures = captures + 1;\n    }\n    return captures;\n  };\n  // Returns next x,y position\n  next (point, dir) {\n    var nP = new Point(point.x, point.y);\n    // log (\"  (\" + point.x  + \",\" + point.y + \") dir: \" + dir);\n    if ((point.y & 1) === 0) {\n      nP.add(evenRowVec[dir]);\n    } else {\n      nP.add(oddRowVec[dir]);\n    }\n    if ((darworms.dwsettings.gridGeometry == 'falloff' && ((nP.x < 0) || (nP.x > this.width - 1) || (nP.y < 0) || (nP.y > this.height - 1)))) {\n      // log (\"  (\" + nP.x  + \",\" + nP.y + \") returning noWhere\");\n      return darworms.dwsettings.noWhere;\n    }\n    if (nP.x < 0) {\n      nP.x = this.width - 1;\n    }\n    if (nP.x > this.width - 1) {\n      nP.x = 0;\n    }\n    if (nP.y < 0) {\n      nP.y = this.height - 1;\n    }\n    if (nP.y > this.height - 1) {\n      nP.y = 0;\n    }\n    // log (\"    next from: (\" + point.format()  + \" dir \" + dir + \" next:  \" + nP.format());\n    return nP;\n  };\n  each (action) {\n    for (var y = 0; y < this.height; y++) {\n      for (var x = 0; x < this.width; x++) {\n        var point = new Point(x, y);\n        action(point, this.valueAt(point));\n      }\n    }\n  };\n  logSpokesAt (point) {\n    log(\"[ \" + point.x + \",\" + point.y + \"] val = \" + this.colorsAt(point).toString(16));\n    for (var dir = 0; dir < 8; dir = dir + 1) {\n      log(\"   spoke: \" + dir + \" colorindex\" + this.spokeAt(point, dir));\n\n    }\n  };\n  logValueAt (point) {\n    log(\"[ \" + point.x + \",\" + point.y + \"] val = 0x\" + this.hexValueAt(point) +\n      this.dirList(this.hexValueAt(point)) + \" outVectors = 0x\" +\n      this.outVectorsAt(point).toString(16) + this.dirList(this.outVectorsAt(point)) +\n      \" inVectors = 0x\" + this.inVectorsAt(point).toString(16));\n  };\n  formatStateAt (point) {\n    return \" x \" + point.x + \" y \" + point.y + \" state 0x\" + this.stateAt(point).toString(16);\n  };\n  dirList (state) {\n    var list = \" directions \";\n    for (var dir = 0; dir < 6; dir = dir + 1) {\n      if (((state & darworms.outMask[dir]) !== 0)) {\n        list = list + \" \" + darworms.compassPts[dir];\n      }\n    }\n    return list;\n  }\n}\n\n\n/* end Grid */\n","import {\n  Point\n} from \"./Point.js\";\nimport {\n  darworms\n} from \"./loader.js\";\nimport {\n  log\n} from \"./utils.js\"\n/**\n * Created with JetBrains WebStorm.\n * User: dmaynard\n * Date: 9/22/13\n * Time: 12:00 AM\n * To change this template use File | Settings | File Templates.\n */\n/* Worm Object */\n\nconst musicalkeys = {\n  \"AMajor\": [\n    darworms.notes.A,\n    darworms.notes.B,\n    darworms.notes.CS,\n    darworms.notes.D,\n    darworms.notes.E,\n    darworms.notes.FS,\n    darworms.notes.GS\n  ],\n  \"BMajor\": [\n    darworms.notes.B,\n    darworms.notes.CS,\n    darworms.notes.DS,\n    darworms.notes.E,\n    darworms.notes.FS,\n    darworms.notes.GS,\n    darworms.notes.AS\n  ],\n  \"CMajor\": [\n    darworms.notes.C1,\n    darworms.notes.D,\n    darworms.notes.E,\n    darworms.notes.F,\n    darworms.notes.G,\n    darworms.notes.A,\n    darworms.notes.B\n  ],\n  \"CMinor\": [\n    darworms.notes.C1,\n    darworms.notes.D,\n    darworms.notes.EF,\n    darworms.notes.F,\n    darworms.notes.G,\n    darworms.notes.AF,\n    darworms.notes.BF\n  ],\n\n  \"DMajor\": [\n    darworms.notes.D,\n    darworms.notes.E,\n    darworms.notes.FS,\n    darworms.notes.G,\n    darworms.notes.A,\n    darworms.notes.B,\n    darworms.notes.CS\n  ],\n\n  \"EMajor\": [\n    darworms.notes.E,\n    darworms.notes.FS,\n    darworms.notes.GS,\n    darworms.notes.A,\n    darworms.notes.B,\n    darworms.notes.CS,\n    darworms.notes.DS\n  ],\n  \"FMajor\": [\n    darworms.notes.F,\n    darworms.notes.G,\n    darworms.notes.A,\n    darworms.notes.BF,\n    darworms.notes.C2,\n    darworms.notes.D,\n    darworms.notes.E\n  ],\n  \"GMajor\": [\n    darworms.notes.G,\n    darworms.notes.A,\n    darworms.notes.B,\n    darworms.notes.C2,\n    darworms.notes.D,\n    darworms.notes.E,\n    darworms.notes.FS\n  ]\n};\n\nexport class Worm {\n  constructor(colorIndex, state) {\n    this.colorIndex = colorIndex;\n    this.dna = new Array(64);\n    this.state = state;\n    this.nMoves = 0;\n    this.score = 0;\n    this.prevScore = 0;\n    this.numChoices = 0;\n    this.died = false;\n    this.name = \"\";\n    this.wType = 0; // None (asleep)\n    this.typeName = \"\";\n    this.directionIndex = 0;\n    this.diedAtFrame = 0;\n    this.showTutorial = true;\n\n\n    this.musickeyName = \"CMajor\";\n\n    this.MusicScale = [],\n\n      this.audioSamplesPtrs = [];\n    this.pos = new Point(-1, -1);\n    this.startingPos = new Point(-1, -1);\n\n    for (var i = 0; i < 64; i = i + 1) {\n      this.dna[i] = darworms.dwsettings.codons.unSet;\n    }\n\n    this.dna[63] = darworms.dwsettings.codons.isTrapped;\n    this.numChoices = 1;\n    // set all the forced moves\n    for (var j = 0; j < 6; j = j + 1) {\n      this.dna[0x3F ^ (1 << j)] = j;\n      this.numChoices += 1;\n    }\n    this.randomize();\n    this.toText();\n  }\n\n  init(wType) {\n    this.nMoves = 0;\n    this.score = 0;\n    this.prevScore = 0;\n    this.MusicScale = musicalkeys[\"CMajor\"];\n    if (wType === 0) { // none   asleep\n      this.state = 3; // sleeping\n    }\n    if (wType === 1) { // random\n      for (var i = 0; i < 64; i = i + 1) {\n        this.dna[i] = darworms.dwsettings.codons.unSet;\n      }\n      this.dna[63] = darworms.dwsettings.codons.isTrapped;\n      this.numChoices = 1;\n      // set all the forced moves\n      for (var j = 0; j < 6; j = j + 1) {\n        this.dna[0x3F ^ (1 << j)] = j;\n        this.numChoices += 1;\n      }\n      this.randomize(); // sleeping\n    }\n    if (wType === 2) { // same\n      this.state = 2; // paused\n    }\n    if (wType === 3) { // new\n      for (var k = 0; k < 64; k = k + 1) {\n        this.dna[k] = darworms.dwsettings.codons.unSet;\n      }\n      this.dna[63] = darworms.dwsettings.codons.isTrapped;\n      this.numChoices = 1;\n      // set all the forced moves\n      for (var n = 0; n < 6; n = n + 1) {\n        this.dna[0x3F ^ (1 << n)] = n;\n        this.numChoices += 1;\n      }\n      this.state = 2; // paused\n    }\n    this.toText();\n  };\n\n  setNotes(index) {\n    this.instrument = index;\n    this.audioSamplesPtrs.length = 0;\n    for (var j = 0; j < 7; j = j + 1) {\n      this.audioSamplesPtrs.push(index); // c2,wav\n    }\n\n  }\n  setKey(keyName) {\n    log(\" keyname: \" + keyName)\n    this.musickeyName = keyName;\n    this.MusicScale = musicalkeys[keyName];\n  }\n\n  playScale() {\n    for (var j = 0; j < 7; j = j + 1) {\n      darworms.directionIndex = j;\n      var sorted = this.MusicScale;\n      sorted.sort(function(a, b) {\n        return a - b;\n      });\n      setTimeout(function(that, index, notes) {\n        if (that.audioSamplesPtrs[index] >= 0) {\n          darworms.audioSamples[that.audioSamplesPtrs[index]].\n          playSample(darworms.audioPlaybackRates[notes[index]], 0.0);\n        }\n        //do what you need here\n      }, 500 * j, this, j, sorted);\n\n    }\n  }\n  getMoveDir(value) {\n    if (value === 0x3F) { // trapped\n      this.state = wormStates.dead;\n      this.died = true;\n      return 6;\n    }\n    return this.dna[value & 0x3F];\n  };\n  shouldDrawScore() {\n    if (this.score !== this.prevScore || (this.nMoves <= 2)) {\n      this.prevScore = this.score;\n      return true;\n    }\n    if (this.died) {\n      this.died = false; // one-shot\n      return true;\n    }\n    return false;\n  };\n  randomize() {\n    var dir;\n    for (var i = 0; i < 63; i = i + 1) {\n      // log(\" randomize loop start  i = \" + i + \" dna[i] = \" + this.dna[i]);\n      if (this.dna[i] === darworms.dwsettings.codons.unSet) {\n        for (var j = 0; j < 1000; j = j + 1) {\n          dir = Math.floor(Math.random() * 6);\n          //log( \" dir = \" + dir +  \" i=\" + i + \" outMask[dir] = \" + outMask[dir] + \"& = \" + (i & outMask[dir]));\n          if ((i & darworms.outMask[dir]) === 0) {\n            this.dna[i] = dir;\n            this.numChoices += 1;\n            // log(\" Setting dir 0x\" + i.toString(16) + \" to \" + compassPts[dir]);\n            break;\n          }\n        }\n        if (this.dna[i] === darworms.dwsettings.codons.unSet) {\n          log(\"Error we rolled craps 10,000 times in a row\");\n        }\n      }\n      // log(\" randomize loop end  i = \" + i + \" dna[i] = \" + this.dna[i]);\n    }\n    this.toText();\n  };\n  log() {\n    var dir;\n    log(\" Worm State: \" + darworms.wormStateNames[this.state] + \" at \" + (this.pos !== undefined ? this.pos.format() : \"position Undefined\"));\n  };\n  place(aState, aGame, pos) {\n    this.pos = pos;\n    this.startingPos = pos;\n    this.nMoves = 0;\n    this.score = 0;\n    this.state = aState;\n    log(\" placing worm   i = \" + this.colorIndex + \" state \" + aState + \" \" + this.numChoices + \" of 64 possible moves defined\");\n  };\n  dump() {\n    this.log();\n    for (var i = 0; i < 64; i = i + 1) {\n      log(\" dna\" + i + \" = \" + darworms.compassPts[this.dna[i]]);\n      var spokes = [];\n      for (var spoke = 0; spoke < 6; spoke = spoke + 1) {\n        if ((i & darworms.outMask[spoke]) !== 0) {\n          spokes.push(darworms.compassPts[spoke]);\n        }\n      }\n      log(\" dna\" + i + \" \" + spokes + \" = \" + darworms.compassPts[this.dna[i]]);\n    }\n\n  };\n  toText() {\n    this.name = \"\";\n\n    for (var i = 0; i < 64; i = i + 1) {\n      if (this.dna[i] === 0) this.name += 'A';\n      if (this.dna[i] === 1) this.name += 'B';\n      if (this.dna[i] === 2) this.name += 'C';\n      if (this.dna[i] === 3) this.name += 'D';\n      if (this.dna[i] === 4) this.name += 'E';\n      if (this.dna[i] === 5) this.name += 'F';\n      if (this.dna[i] === 6) this.name += '?';\n      if (this.dna[i] === 7) this.name += 'X';\n      if (this.dna[i] > 7) this.name += '#';\n    };\n    return this.name;\n  };\n\n  fromText(dnastring) {\n    var regx = /^[ABCDEF\\?]{63}X$/;\n    if (!(regx.test(dnastring))) {\n      return false;\n    }\n    var gooddna = true;\n    for (var i = 0; i < 63; i = i + 1) {\n      switch (dnastring.charAt(i)) {\n        case 'A':\n          this.dna[i] = 0;\n          break;\n        case 'B':\n          this.dna[i] = 1;\n          break;\n        case 'C':\n          this.dna[i] = 2;\n          break;\n        case 'D':\n          this.dna[i] = 3;\n          break;\n        case 'E':\n          this.dna[i] = 4;\n          break;\n        case 'F':\n          this.dna[i] = 5;\n          break;\n        case '?':\n          this.dna[i] = 6;\n          break;\n        default:\n          alert(\" illegal dna string at position \" + (i + 1));\n          return (false);\n      }\n      if (!(((1 << this.dna[i]) & i) === 0) && (this.dna[i] !== 6)) {\n        alert(\"illegal direction \" + dnastring.charAt(i) + \"(\" + darworms.compassPts[this.dna[i]] +\n          \")\" + \"given for cell \" + i);\n        gooddna = false;\n      }\n    }\n    if (gooddna) {\n      this.toText();\n    }\n    return gooddna;\n  };\n\n  emailDarworm () {\n    log(\"Emailing: \" + this.toText());\n    var mailtourl = \"mailto:?subject=\" +\n      encodeURIComponent(\"Check out this cool Darworm\") +\n      \"&body=\" +\n      encodeURIComponent(\"Darworms is a free web game available at \\n\") +\n      encodeURIComponent( darworms.host + \"\\n\") +\n      // encodeURIComponent('<a href =\"https://dmaynard.github.io/Darworms/public> Darworms\" </a>') +\n      encodeURIComponent(\"You can copy the darworm string below and then go to the game and paste the text into one of the players\\n\") +\n      encodeURIComponent(this.toText());\n    log(\"url: \" + mailtourl);\n\n    // document.location.href = mailtourl;\n    window.open(mailtourl);\n\n  }\n\n};\n/* end of Worm */\n","import {\n  darworms\n} from \"./loader.js\";\nimport AudioSample from \"./AudioSample.js\";\nimport {\n  Point\n} from \"./Point.js\";\nimport \"./Grid.js\";\nimport {\n  Worm,\n} from \"./Worm.js\";\nimport {\n  Game,\n  gameInit,\n  makeMoves,\n  selectDirection,\n  updateScores\n} from \"./Game.js\";\nimport {\n  graphicsInit,\n  reScale,\n  wCanvas,\n  wGraphics,\n  drawPickCells,\n  drawCells,\n  drawDirtyCells,\n  clearCanvas,\n  setGrid,\n  setScale,\n  resizeCanvas\n} from \"./graphics.js\";\nimport {\n  scoreCanvasInit\n} from \"./scorecanvas.js\";\nimport {\n  emailGame,\n  saveGame,\n  loadGames,\n  freeGames\n} from \"./gameio.js\"\nimport {\n  log\n} from \"./utils.js\"\n/*\n  <script src=\"scripts/loader.js\"></script>\n  <script src=\"scripts/AudioSample.js\"></script>\n  <script src=\"scripts/Point.js\"></script>\n  <script src=\"scripts/Grid.js\"></script>\n  <script src=\"scripts/Worm.js\"Games></script>\n  <script src=\"scripts/WPane.js\"></script>\n  <script src=\"scripts/Game.js\"></script>\n  <script src=\"scripts/main.js\"></script>\n*/\n/*  DarWorms\n Copyright BitBLT Studios inc\n Author: David S. Maynard\n Deployment to Rackspace:\n scp -r -P 12960 ~/projects/SumoWorms/www/*.* dmaynard@bitbltstudios.com:/var/www/darworms/\n git push bitbltstudios:~/repo/ master\n\n darworms.com\n\n   interesting DarWorms\n EEF?A??FB??F?FF?CC?F?FF???A?FF?FD??E?EE??CE?E??E?DD?D??DB??C?BAX\n DBCDAFEDCEFFEFEEFFADDBADBCFFFFAFBCCCADEDBBAEBBEEABDDABDDCBACABAX\n AEF?AE?DB??F?FF?C??C?FF??FA?FF?FD??C?BE??CA?A??E?B??A??DA??C?BAX\n AEF?AE?EB??F?FF?C??D?FD??BC?B??FD??D?DE??CC?B??E?DA?BD?DB??C?BAX\n AEF?AE?FB??E?FF?C??F?FD??FC?BF?FD??D?EA??CA?A??E?BD?A??DB??C?BAX\n AEF?AB?FB??F?FE?C??C?FA??BA?A??FD??D?EEE?EA?E??E?CA?D??DC??C?BAX\n //  nice   almost perfect worm (316)\n AEF?AE?FB??C?FE?C??D?DF??CA?AF?FD??E?BA??BA?A??E?DD?A??DC??C?BAX\n\n // perfect\n DFADAFEEFBCEBFEFDDCDBDADCBAFBBAFEDCEBEDEAEECAEAEDDADDBDDBBACABAX\n\n // perfect and interesting\n FDEDBDAEABFEBEEFCFDFBFFFFBCCBBAFDBEDAEDEACCCBBAEACCCBDADCCCCBBAX\n\n // nice score  297\n AEF?AF?FB??E?FA?C??F?DD??CA?F??FD??E?BAE?EE?E??E?BD?D??DA??C?BAX\n\n // 116\n AEF?AE?FB??C?BE?C??F?DD??FA?BF?FD??E??A??CC?B??E?D??D??DC??C?BAX\n\n //  short  score 10\n //  short score 42\n AEF?AE?FB??C?BE?C??F?DDF??C?B??FD??E??A??EA?B??E?DA?D??DC??C?BAX\n// short score 2\n AEF?AB?FB????B?EC??F?B????C????FD?????E???C????E?D??B??DC??C?BAX\n// nice 30\nAEF?AF?FB????BA?C??F?DA???F?B??FD??E?D?D???????E?D??D??DC??C?BAX\n\n\nLOGO Darworm  (score 3)\nDFA?B??FC?????A?D???????C???B??FE??E???????????E?D?????D???CBBAX\nDFA?B??FC?????A?D???????C???B??FE??ED??????????E?D?????DC??CBBAX\nDFA?B?AFC???E?A?D???????CF??B??FE??ED?D??B?????E?D?????DC??CBBAX\nDFA?B?AFC???E?A?D???????CF??B??FE??ED?DE?B?????E?D?????DC??CBBAX\nDFA?B?AFC???E?A?D???????CF??B??FE??ED?D??B?????E?D?????DC??CBBAX\nDFA?B?AFC???E?A?D???????C???B?AFE??EDB?E????B??E?D??B??DC??CBBAX\nDFA?B?AFC???E?A?D???????C???B?AFE??EDB?E?C??B??E?D??B??DC??CBBAX\n\n// Almost space filling\n FEF?A??FB??C?BA?C??D?DF??BA?B??FD?EE?BA??EE?A??E?DD?D?DDC??C?BAX\n\n// good for fall off edge gameState\nEFA?B??FB??C??A?C??FDD????C?B??FD??E?E???EC?B??E????B??DC??CBBAX\nEFA?B??FB??C??A?C??FDD????C?B??FD??E?E???EC?B??E?D??B??DC??CBBAX\n\n// Interesting two player gamestate\nEFAFB?AFC?CC?BE?D??F?DA??BFFB??FE??E?EAE?EC?B??E?DA?BBADC??C?BAX\nFBCFEFFFBEEFBEEEFDCDFDAFACFCFFFFDDCCEDEDCBCEBBEEABDDBDDDCCACBBAX\n//  new worm filled completly via game play\nEBCCDBADECCCBBEEFBCCDBFFFFFCFFFFEBCCDEADCECCEBEEDBACDBDDABCCBBAX\n*/\n\ndarworms.main = (function() {\n\n  var deviceInfo = function() {\n    alert(\"This is a deviceInfo.\");\n    document.getElementById(\"width\").innerHTML = screen.width;\n    document.getElementById(\"height\").innerHTML = screen.height;\n    document.getElementById(\"colorDepth\").innerHTML = screen.colorDepth;\n  };\n  /* Game Globals  Done   wrap these globals in a function  */\n\n  var useKalimbaAudio = false;\n  var usePianoAudio = true;\n  var useSitarAudio = false;\n\n  var playerTypes = [3, 0, 1, 0];\n  var buttonNames = ['#p1button', '#p2button', '#p3button', '#p4button',\n    '#p1Lbutton', '#p2Lbutton', '#p3Lbutton', '#p4Lbutton'\n  ];\n  var typeNames = [\" None \", \"Random\", \" Same \", \" New  \"];\n  var textFields = ['#p1textfield', '#p2textfield', '#p3textfield', '#p4textfield', '#edittextfield'];\n\n\n\n\n  var gWorms = [new Worm(1, darworms.wormStates.paused), new Worm(2, darworms.wormStates.paused), new Worm(3, darworms.wormStates.paused), new Worm(4, darworms.wormStates.paused)];\n\n\n  var setButtonNames = function() {\n    // document.getElementById(\"p1button\").innerHTML = typeNames[players[0]];\n    // document.getElementById(\"p1button\").html(typeNames[players[0]]).button(\"refresh\");\n    $(\"#p1button\").text(typeNames[playerTypes[0]]);\n    $(\"#p2button\").text(typeNames[playerTypes[1]]);\n    $(\"#p3button\").text(typeNames[playerTypes[2]]);\n    $(\"#p4button\").text(typeNames[playerTypes[3]]);\n\n    $(\"#p1Lbutton\").text(typeNames[playerTypes[0]]);\n    $(\"#p2Lbutton\").text(typeNames[playerTypes[1]]);\n    $(\"#p3Lbutton\").text(typeNames[playerTypes[2]]);\n    $(\"#p4Lbutton\").text(typeNames[playerTypes[3]]);\n    var bref = $(\"#p4button\");\n    var brefa = bref[0];\n\n    gWorms.forEach(function(worm, i) {\n      worm.wType = playerTypes[i];\n      worm.typeName = typeNames[worm.wType];\n      // worm.setNotes(i);\n      $(buttonNames[i]).removeClass(\n        playerTypes[i] === 0 ? \"ui-opaque\" : \"ui-grayed-out\");\n      $(buttonNames[i]).addClass(\n        playerTypes[i] === 0 ? \"ui-grayed-out\" : \"ui-opaque\");\n    });\n  };\n\n  var setupEditPage = function() {\n    // darworms.selectedIdx = $.mobile.activePage.attr(\"data-selecteddarworm\");\n    if (darworms.theGame && darworms.theGame.gameState !== darworms.gameStates.over) {\n      $('.darwormTypeRadioButtons').hide();\n      $('.playKeyNotes').hide();\n    } else {\n      $('.darwormTypeRadioButtons').show();\n      $('.playKeyNotes').show();\n      var darwormType = playerTypes[darworms.selectedIdx];\n      var color = darworms.colorNames[darworms.selectedIdx];\n      switch (darwormType) {\n        case 0:\n          $('#' + 'edit' + '-radio-choice-1').prop(\"checked\", true).checkboxradio(\"refresh\");\n          break\n        case 1:\n          $('#' + 'edit' + '-radio-choice-2').prop(\"checked\", true).checkboxradio(\"refresh\");\n          break;\n        case 2:\n          $('#' + 'edit' + '-radio-choice-3').prop(\"checked\", true).checkboxradio(\"refresh\");\n          break;\n        case 3:\n          $('#' + 'edit' + '-radio-choice-4').prop(\"checked\", true).checkboxradio(\"refresh\");\n          break;\n      }\n      var selectinput = 'input[name=' + 'edit' + '-radio-choice]';\n\n      // $('input[name=green-radio-choice]').checkboxradio(\"refresh\");\n      // var selectedType = $(selectinput + ':checked').val();\n      $(selectinput).checkboxradio(\"refresh\");\n      // gWorms.forEach(function(worm, i) {\n      //  worm.toText();\n      $(\"input[name='edit-textname']\").textinput({\n        theme: darworms.themes[darworms.selectedIdx]\n      });\n      $(textFields[4]).val(playerTypes[darworms.selectedIdx] == 0 ? \"\" : gWorms[darworms.selectedIdx].name);\n      //  })\n    }\n  }\n\n  var setSelectedDarwormType = function() {\n    /*\n     if (darworms.theGame && darworms.theGame.gameState !== darworms.gameStates.over) {\n       return;\n     }\n     var color = darworms.colorNames[darworms.selectedIdx];\n     var selectinput = 'input[name=' + 'edit' + '-radio-choice]';\n     var selectedType = $(selectinput + ':checked').val();\n     switch (selectedType) {\n       case \"none\":\n         playerTypes[darworms.selectedIdx] = 0;\n         break;\n       case \"random\":\n         playerTypes[darworms.selectedIdx] = 1;\n         break;\n       case \"same\":\n         playerTypes[darworms.selectedIdx] = 2;\n         break;\n       case \"new\":\n         playerTypes[darworms.selectedIdx] = 3;\n         break\n\n       default:\n         alert(\"unknown type\");\n     }\n     */\n    setButtonNames();\n  }\n\n  var showSettings = function() {\n    if (darworms.theGame && darworms.theGame.gameState !== darworms.gameStates.over) {\n      $('#geometryradios').hide();\n      $('#gridsizeslider').hide();\n      $('#abortgame').show();\n    } else {\n      $('#geometryradios').show();\n      $('#gridsizeslider').show();\n      $('#abortgame').hide();\n    }\n\n    $('#fps').val(darworms.graphics.fps).slider(\"refresh\");\n\n    $('#gridsize').val(darworms.dwsettings.gridSize).slider(\"refresh\");\n    $('#backg').val(darworms.dwsettings.backGroundTheme).slider(\"refresh\");\n    $('#doanim').val(darworms.dwsettings.doAnimations).slider(\"refresh\");\n    $('#audioon').val(darworms.dwsettings.doAudio).slider(\"refresh\");\n    $('#fixedinitpos').val(darworms.dwsettings.fixedInitPos).slider(\"refresh\");\n\n    $('#pickDirectionUI').val(darworms.dwsettings.pickDirectionUI).slider(\"refresh\");\n\n\n  }\n\n  var applySettings = function() {\n\n    darworms.dwsettings.gridGeometry = $('input[name=geometry-radio-choice]:checked').val();\n    if (darworms.dwsettings.backGroundTheme !== $('#backg').slider().val()) {\n      darworms.dwsettings.backGroundTheme = $('#backg').slider().val();\n      if (darworms.theGame) {\n        clearCanvas();\n        drawCells();\n      }\n    }\n    darworms.dwsettings.gridSize = parseInt($('#gridsize').val());\n    darworms.dwsettings.doAnimations = $('#doanim').slider().val() == \"true\" ? true : false;\n    darworms.dwsettings.doAudio = $('#audioon').slider().val() == \"1\" ? 1 : 0;;\n    darworms.dwsettings.fixedInitPos = $('#fixedinitpos').slider().val() == \"1\" ? 1 : 0;;\n\n    darworms.dwsettings.pickDirectionUI = $('#pickDirectionUI').slider().val() == \"1\" ? 1 : 0;\n\n    log(\" darworms.dwsettings.doAnimations \" + darworms.dwsettings.doAnimations);\n    log(\" darworms.dwsettings.doAudio \" + darworms.dwsettings.doAudio);\n    darworms.dwsettings.masterAudioVolume = $(\"#audiovol\").val() / 100;\n    darworms.graphics.fps = parseInt($(\"#fps\").val());\n    darworms.graphics.frameInterval = 1000 / darworms.graphics.fps;\n\n    log(\" darworms.dwsettings.masterAudioVolume \" + darworms.dwsettings.masterAudioVolume);\n  }\n\n  var injectSettings = function(gameTxt) {\n    var gameObj = JSON.parse(gameTxt);\n    darworms.dwsettings.gridGeometry = gameObj.gridGeometry;\n    if (darworms.dwsettings.backGroundTheme !== gameObj.backGroundTheme) {\n      darworms.dwsettings.backGroundTheme = gameObj.backGroundTheme;\n      if (darworms.theGame) {\n        clearCanvas();\n        drawCells();\n      }\n    }\n    darworms.dwsettings.doAnimations = gameObj.doAnimations;\n    darworms.dwsettings.doAudio = gameObj.doAudio;\n    darworms.dwsettings.fixedInitPos = gameObj.fixedInitPos;\n\n    darworms.dwsettings.pickDirectionUI = gameObj.pickDirectionUI;\n    darworms.dwsettings.masterAudioVolume = gameObj.masterAudioVolume\n    darworms.graphics.fps = gameObj.fps;\n    darworms.graphics.frameInterval = 1000 / darworms.graphics.fps;\n    darworms.dwsettings.gridSize = gameObj.width;\n\n    var regx = /^[ABCDEF\\?]{63}X$/;\n    gameObj.players.forEach(function(aworm) {\n      var i = aworm.index;\n      gWorms[i].name = aworm.name;\n\n      //  decode  tyename therefore\n\n      if (regx.test(gWorms[i].name)) {\n        if (!gWorms[i].fromText(gWorms[i].name)) {\n          alert(\"Invalid DNA for Daworm # \" + (i + 1) + \" \");\n          gWorms[i].wType = 0;\n        };\n\n      }\n\n      gWorms[i].wType = aworm.typeName == \" None \" ? 0 : 2;\n      playerTypes[i] = gWorms[i].wType\n      gWorms[i].score = aworm.score;\n      gWorms[i].instrument = aworm.instrument;\n      gWorms[i].setNotes(aworm.instrument);\n      gWorms[i].musickeyName = aworm.musickeyName;\n      gWorms[i].MusicScale = aworm.MusicScale;\n\n    });\n    return gameObj;\n  }\n\n  var setupGridGeometry = function() {\n    log(\" pagebeforeshow setupGridGeometry \");\n    if (darworms.theGame && darworms.theGame.gameState !== darworms.gameStates.over) {\n      $('#geometryradios').hide();\n    } else {\n      $('#geometryradios').show();\n    }\n\n    var gridGeometry = darworms.dwsettings.gridGeometry;\n\n    switch (gridGeometry) {\n      case 'torus':\n        $('#geometry-radio-torus').prop(\"checked\", true).checkboxradio(\"refresh\");\n        break;\n      case 'falloff':\n        $('#geometry-radio-falloff').prop(\"checked\", true).checkboxradio(\"refresh\");\n        break;\n      case 'reflect':\n        $('#geometry-radio-reflect').prop(\"checked\", true).checkboxradio(\"refresh\");\n        break;\n      default:\n        alert(\" unknown grid geometry requested: \" + gridGeometry);\n\n    }\n  }\n\n\n  /* The following code is called from the game timer */\n\n  /* This sh.right {\n   float: right;\n   width: 300px;\n   background-color: #b0e0e6;\n   }ould be wrapped in an anonymous function closure */\n\n\n  // var localImage;\n\n  var updateGameState = function() {\n    // This is the game loop\n    // Called from timer (should be the requestAnimation timer)\n    // We either make one round of moves\n    // or if we are waiting for user input\n    // and we draw the direction selection screen\n    //\n    // log(\" updateGameState: gameState \" +  gameStateNames[theGame.gameState]);\n    // log(\"R\");\n    darworms.graphics.animFrame = darworms.graphics.animFrame + 1;\n    if (darworms.theGame.gameState === darworms.gameStates.running) {\n      // log(\"R\");\n      if (darworms.dwsettings.doAnimations) makeMoves();\n\n    }\n    if (darworms.theGame.gameState === darworms.gameStates.waiting) {\n      // log(\"w\");\n      darworms.theGame.drawPickCells();\n    }\n\n  };\n\n  var pointerEventToXY = function(e) {\n    var out = {\n      x: 0,\n      y: 0\n    };\n    if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\n      var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];\n      out.x = touch.pageX;\n      out.y = touch.pageY;\n    } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\n      out.x = e.pageX;\n      out.y = e.pageY;\n    } else if (e.type == 'tap') {\n      out.x = (e.clientX || e.changedTouches[0].pageX) - (e.currentTarget.offsetLeft);\n      out.y = (e.clientY || e.changedTouches[0].pageY) - (e.currentTarget.offsetTop);\n    }\n    return out;\n  };\n\n  var wormEventHandler = function(event) {\n    var loc = pointerEventToXY(event)\n    var touchX = loc.x;\n    var touchY = loc.y\n    /*\n    var touchX = (event.offsetX || event.clientX);\n    var touchY = (event.offsetY || event.clientY);\n    var touchX = touchX - event.currentTarget.;  //  padding between canvas container and wcanvas\n    var touchY = touchY - 15;  //  padding between canvas container and wcanvas\n    // alert( event.toString() + \" tap event x:\" + touchX + \"  y:\" + touchY)\n    */\n\n    log(\" Tap Event at x: \" + touchX + \" y: \" + touchY);\n    // log(\" wcanvas css   width \" + $('#wcanvas').width() + \" css   height \" + $('#wcanvas').height());\n    // log (\" wcanvas coord width \" + wCanvas.width + \" coord height \"  + wCanvas.height  );\n    if (darworms.theGame.gameState === darworms.gameStates.waiting) {\n      selectDirection(new Point(touchX, touchY));\n    }\n  };\n  darworms.menuButton = function() {\n    log(\" menuButton\");\n    if (darworms.theGame.gameState && ((darworms.theGame.gameState == darworms.gameStates.running) ||\n        (darworms.theGame.gameState == darworms.gameStates.paused))) {\n      darworms.theGame.gameState = darworms.gameStates.paused;\n      $.mobile.changePage(\"#settingspage\");\n      darworms.theGame.needsRedraw = true;\n      drawCells();\n      $(\"#startpause\").text(\"Resume Game\");\n    } else {\n      if (darworms.theGame.gameState == darworms.gameStates.waiting) {\n        $.mobile.changePage(\"#settingspage\");\n      } else {\n        $.mobile.changePage(\"#menupage\");\n      }\n    }\n  }\n  darworms.setKeyVal = function(index) {\n    var selectedKeyInput = $('#select-native-key');\n    if (selectedKeyInput.length == 1) {\n      gWorms[darworms.selectedIdx].setKey(selectedKeyInput.val());\n    }\n  }\n  darworms.setInstrumentVal = function(index) {\n    var selectedInstrumentInput = $('#select-native-edit');\n    if (selectedInstrumentInput.length == 1) {\n      var instrument = parseInt(selectedInstrumentInput.val());\n      gWorms[darworms.selectedIdx].setNotes(instrument);\n\n    }\n  }\n  darworms.sendemail = function() {\n    log(\" sendEMail \" + darworms.gameTxt);\n    emailGame(darworms.gameTxt);\n  }\n\n  darworms.saveGame = function() {\n    log(\" saveGame \");\n    saveGame(darworms.gameTxt);\n  }\n\n  darworms.startgame = function(startNow) {\n    log(\" Startgame start now = \" + startNow);\n    if (darworms.theGame) {\n      log(\"GameState is \" +\n        darworms.theGame.gameState + (darworms.gameStateNames[darworms.theGame.gameState]));\n    }\n    // wCanvas.width = $('#wcanvas').width();\n    // wCanvas.height = $('#wcanvas').height(); // make it square\n    darworms.dwsettings.isLargeScreen = wCanvas.width >= darworms.dwsettings.minLargeScreenWidth;\n    var curScreen = new Point(wCanvas.width, wCanvas.height);\n    darworms.wCanvasPixelDim = curScreen;\n\n    if (darworms.theGame === undefined || darworms.theGame === null || darworms.theGame.grid.height != darworms.dwsettings.gridSize ||\n      !(darworms.wCanvasPixelDim.isEqualTo(curScreen))) {\n      log(\" theGame size has changed Screen is\" + curScreen.format() + \" grid = \" + darworms.dwsettings.gridSize + \" x \" +\n        darworms.dwsettings.gridSize);\n      if ((darworms.dwsettings.gridSize & 1) !== 0) {\n        // height must be an even number because of toroid shape\n        darworms.dwsettings.gridSize = darworms.dwsettings.gridSize + 1;\n      }\n\n      if ($('#debug').slider().val() === 1) {\n        alert(\" wCanvas \" + wCanvas.width + \" x \" + wCanvas.height +\n          \" css \" + $('#wcanvas').width() + \" x \" + $('#wcanvas').height() +\n          \" window \" + window.innerWidth + \" x \" + window.innerHeight);\n      }\n      darworms.theGame = new Game(darworms.dwsettings.gridSize, darworms.dwsettings.gridSize);\n    }\n    if (darworms.theGame.gameState === darworms.gameStates.over) {\n      darworms.theGame.initGame();\n      $(\"#startpause\").text(\"Start Game\");\n      darworms.theGame.needsRedraw = true;\n      drawCells();\n      darworms.theGame.worms = gWorms;\n      log(\" init gridsize: \" + $(\"#gridsize\").val() + \" gHeight\" + darworms.dwsettings.gridSize);\n\n      gWorms.forEach(function(worm, i) {\n        worm.init(playerTypes[i]);\n        if (playerTypes[i] !== 0) { //  not None\n\n          $(buttonNames[i]).addClass(\"ui-opaque\");\n        } else {\n          $(buttonNames[i]).addClass(\"ui-grayed-out\");\n        }\n        // $(textFields[i]).val(worm.toText());\n        var startingPoint = ((darworms.dwsettings.fixedInitPos == 1) ? darworms.theGame.origin :\n          (playerTypes[i] == 2) ? worm.startingPos : // Same\n          new Point((Math.floor(Math.random() * darworms.theGame.grid.width)),\n            (Math.floor(Math.random() * darworms.theGame.grid.height))));\n\n\n        worm.place(darworms.initialWormStates[playerTypes[i]], darworms.theGame,\n          startingPoint);\n        if (playerTypes[i] !== 0) { //  not None\n          darworms.theGame.grid.setSinkAt(startingPoint);\n        }\n      })\n    }\n    setButtonNames();\n    if (startNow === false) return;\n    updateScores(gWorms);\n    log(\" NEW in startgame darworms.dwsettings.doAnimations \" + darworms.dwsettings.doAnimations);\n    if (darworms.theGame.gameState === darworms.gameStates.running) {\n      // This is now a pause game button\n      // clearInterval(darworms.graphics.timer);\n      // document.getElementById(\"startpause\").innerHTML = \"Resume Game\";\n      $(\"#startpause\").text(\"Resume Game\");\n      darworms.theGame.gameState = darworms.gameStates.paused;\n      darworms.theGame.needsRedraw = true;\n      drawCells();\n      return;\n    }\n    if (darworms.theGame.gameState === darworms.gameStates.paused) {\n      // This is now a start game button\n      // document.getElementById(\"startpause\").innerHTML = \"Pause Game\";\n      $(\"#startpause\").text(\"Pause\");\n      darworms.theGame.gameState = darworms.gameStates.running;\n      // darworms.graphics.timer = setInterval(updateGameState, 1000 / $(\"#fps\").val());\n      // startGameLoop( $(\"#fps\").val());\n      return;\n    }\n    if (darworms.theGame.gameState === darworms.gameStates.over) {\n      // This is now a start game button\n      // alert(\"About to Start Game.\");\n      darworms.theGame.gameState = darworms.gameStates.running;\n      // darworms.graphics.timer = setInterval(updateGameState, 1000 / $(\"#fps\").val());\n      var animFramesPerSec = darworms.dwsettings.doAnimations ? darworms.graphics.fps : 60;\n      startGameLoop(animFramesPerSec);\n      log(\" setInterval: \" + 1000 / $(\"#fps\").val());\n      // document.getElementById(\"startpause\").innerHTML = \"Pause Game\";\n      $(\"#startpause\").text(\"Pause Game\");\n      initTheGame(true);\n      darworms.theGame.log();\n    }\n    if (!darworms.dwsettings.doAnimations) {\n      // run game loop inline and draw after game is over\n      //  No.  This locks the browser.  We must put it inside the the\n      // animation request and do a set of moves each animframe and draw the\n      // playfield\n      log('darworms.dwsettings.doAnimations == \"false\"')\n      darworms.theGame.gameState = darworms.gameStates.running;\n      clearCanvas();\n      drawCells();\n\n      log(\" Game Running\");\n      $(\"#startpause\").text(\"Running\");\n      /*  busy loop making moves.  Freezes the javascript engine!\n        while (darworms.theGame.gameState != darworms.gameStates.over) {\n         if (darworms.theGame.gameState === darworms.gameStates.waiting) {\n           break;\n         }\n         if (darworms.theGame.makeMove(false) === false) {\n           darworms.theGame.elapsedTime = darworms.theGame.elapsedTime + new Date().getTime();\n           log(\" Game Over\");\n           darworms.theGame.showTimes();\n           darworms.theGame.gameState = darworms.gameStates.over;\n           $(\"#startpause\").text(\"Start Game\");\n           // wGraphics.restore();\n         }\n       }\n       drawCells();\n       darworms.gameModule.updateScores();\n\n       $(\"#startpause\").text(\"Start Game\");\n       */\n    }\n\n  };\n\n  var startGameLoop = function(frameRate) {\n    darworms.graphics.fps = frameRate;\n    darworms.graphics.frameInterval = 1000 / frameRate;\n    darworms.graphics.iufps = 30;\n    darworms.graphics.uiInterval = 1000 / frameRate;\n    darworms.graphics.animFrame = 0;\n    darworms.graphics.uiFrames = 0;\n\n    darworms.graphics.rawFrameCount = 0;\n    darworms.graphics.drawFrameCount = 0;\n    darworms.graphics.rawFrameCount = 0;\n    darworms.graphics.uiFrameCount = 0;\n    darworms.graphics.then = Date.now();\n\n    darworms.graphics.uiThen = Date.now();\n    darworms.graphics.startTime = darworms.graphics.then;\n    darworms.graphics.uiInterval = 1000 / darworms.graphics.uifps;\n    doGameLoop();\n  };\n\n  var doGameLoop = function() {\n    // This is the game loop\n    // Called from requestAnimationFrame\n    // We either make one round of moves\n    // or if we are waiting for user input\n    // and we draw the direction selection screen\n    //\n\n    darworms.graphics.rawFrameCount++;\n    if (darworms.theGame.gameState == darworms.gameStates.over) {\n      //  end of game cleanup\n      gWorms.forEach(function(worm, i) {\n        if (worm.wType == 3) { //  new\n          worm.wType = 2; // Same\n\n        }\n        worm.toText(); //  update string version of dna\n      })\n      for (let ig = 0; ig < 4; ig++) {\n        playerTypes[ig] = gWorms[ig].wType;\n      }\n      setButtonNames();\n      return;\n    }\n    requestAnimationFrame(doGameLoop);\n    //   makes game moves or select a new direction for a worm\n    //  update graphics\n    darworms.graphics.animFrame = darworms.graphics.animFrame + 1;\n    if (darworms.theGame.gameState === darworms.gameStates.running) {\n      darworms.graphics.now = Date.now();\n      if (darworms.dwsettings.doAnimations) {\n        darworms.graphics.elapsed = darworms.graphics.now - darworms.graphics.then;\n        if (darworms.graphics.elapsed > darworms.graphics.frameInterval) {\n          darworms.graphics.uiFrames = darworms.graphics.uiFrames + 1;\n          makeMoves();\n          darworms.graphics.then = darworms.graphics.now -\n            (darworms.graphics.elapsed % darworms.graphics.frameInterval)\n        }\n\n      } else {\n        var startTime = Date.now();\n        var nMoves = 0;\n        var movesPerFrame = 80; // allows for approx 30 fps with drawing\n        while ((nMoves < movesPerFrame) && (darworms.theGame.gameState != darworms.gameStates.over) &&\n          (darworms.theGame.gameState !== darworms.gameStates.waiting)) {\n          nMoves = nMoves + 1;;\n          makeMoves();\n        }\n        log(\"Compute time: \" + (Date.now() - startTime));\n\n        var startTime = Date.now();\n        updateScores(darworms.theGame.worms);\n        drawDirtyCells();\n        log(\"Draw time: \" + (Date.now() - startTime));\n\n        log(\".\");\n      }\n\n    }\n\n    if (darworms.theGame.gameState === darworms.gameStates.waiting) {\n      darworms.graphics.now = Date.now();\n      darworms.graphics.uiElapsed = darworms.graphics.now - darworms.graphics.uiThen;\n      if (darworms.graphics.uiElapsed > darworms.graphics.uiInterval) {\n        drawPickCells();\n        darworms.graphics.uiThen = darworms.graphics.now -\n          (darworms.graphics.uiElapsed % darworms.graphics.uiInterval)\n      }\n    }\n\n    // if ( darworms.graphics.rawFrameCount %  60 == 0) {\n    //     log(\"Date.now() \" + Date.now());\n    // }\n  }\n\n  darworms.abortgame = function() {\n    log(\"Abort Game called\");\n    $.mobile.changePage('#abortdialog', 'pop', true, true);\n    // $(\"#lnkDialog\").click();\n\n  }\n  darworms.emailDarwormButton = function(index) {\n    log(\"emailDarwormButton called\");\n    gWorms[darworms.selectedIdx].emailDarworm();\n  }\n\n  darworms.playScale = function(index) {\n    log(\"playScale called\");\n    gWorms[darworms.selectedIdx].playScale();\n  }\n  darworms.yesabortgame = function() {\n    log(\"Abort Game called\");\n    $.mobile.changePage('#playpage');\n    darworms.theGame.gameState = darworms.gameStates.over;\n    darworms.startgame(false);\n    // $(\"#lnkDialog\").click();\n\n  }\n\n  darworms.noabortgame = function() {\n    log(\"Abort Game called\");\n    $.mobile.changePage('#settingspage');\n    // $(\"#lnkDialog\").click();\n\n  }\n\n  var preventBehavior = function(e) {\n    e.preventDefault();\n  };\n  var fail = function(msg) {\n    alert(msg);\n  }\n  var initTheGame = function(startNow) {\n\n    gWorms.forEach(function(worm, i) {\n      // $(textFields[i]).val(worm.toText());\n      // worm.setNotes(i);\n    })\n    if (startNow) {\n      darworms.theGame.gameState = darworms.gameStates.running;\n\n    } else {\n      darworms.theGame.gameState = darworms.gameStates.over;\n\n    }\n    // startgame(startNow);\n    darworms.theGame.needsRedraw = true;\n\n  }\n\n  var initPlayPage = function() {\n    var mainbody = $('#myPages');\n    mainbody.css({\n      overflow: 'hidden',\n      height: '100%'\n    });\n    $('#wcanvasparagrap').css({\n\n      background: darworms.dwsettings.cellBackground[darworms.dwsettings.backGroundTheme]\n\n    });\n\n    if (darworms.theGame === undefined || darworms.theGame === null || darworms.theGame.grid.height != darworms.dwsettings.gridSize) {\n      darworms.theGame = new Game(darworms.dwsettings.gridSize, darworms.dwsettings.gridSize);\n      setGrid(darworms.theGame.grid, darworms.theGame)\n    }\n    setButtonNames();\n    drawCells();\n    updateScores(darworms.main.gWorms);\n    if (!darworms.playpageInitialized) {\n      resizeCanvas();\n      darworms.startgame(false);\n      darworms.audioContext.resume();\n      darworms.playpageInitialized = true;\n    }\n  }\n\n  var leavePlayPage = function() {\n    var mainbody = $('#myPages');\n    mainbody.css({\n      overflow: 'auto',\n      height: 'auto'\n    });\n\n    if (!darworms.playpageInitialized) {\n      resizeCanvas();\n      darworms.startgame(false);\n      darworms.audioContext.resume();\n      darworms.playpageInitialized = true;\n    }\n    $(\"body\").css(\"scroll\", \"on\");\n    $(\"body\").css(\"overflow\", \"hidden\");\n  }\n  var swapTheme = function(selector, newTheme) {\n    //  needed because JQuery Mobile only adds additional themes\n    // note we could add a hash table to keep tutorialCheckbox// previously added themes\n    selector.removeClass('ui-page-theme-c');\n    selector.removeClass('ui-page-theme-d');\n    selector.removeClass('ui-page-theme-e');\n    selector.removeClass('ui-page-theme-f');\n    selector.page(\"option\", \"theme\", newTheme);\n  }\n  var initEditPage = function(foo) {\n    log(\" initEditPage \" + darworms.selectedIdx)\n    swapTheme($('#edit-darworm-page'), darworms.themes[darworms.selectedIdx]);\n    $('#edittextfield').val(gWorms[darworms.selectedIdx].wType == 0 ? \"\" : gWorms[darworms.selectedIdx].name);\n    // $('#edit-darworm-page').page.refresh();\n\n    $('[name=select-instrument]').val(gWorms[darworms.selectedIdx].instrument);\n    $('[name=select-instrument]').selectmenu(\"refresh\");\n\n    $('[name=select-key]').val(gWorms[darworms.selectedIdx].musickeyName);\n    $('[name=select-key]').selectmenu(\"refresh\");\n    // $('[name=select-instrument]').refresh();\n    $('#edit-darworm-page').trigger(\"create\");\n  }\n\n  var leaveEditPage = function(foo) {\n    log(\" leaveEditPage \" + foo)\n  }\n\n  var loadSavedGames = function() {\n    log(\" loadSavedGames \");\n    loadGames();\n  }\n\n  var freeSavedGames = function() {\n    log(\" freeSavedGames \");\n    freeGames();\n  }\n\n  function unlockAudioContext(audioCtx) {\n    if (audioCtx.state !== 'suspended') return;\n    const b = document.body;\n    const events = ['touchstart', 'touchend', 'mousedown', 'keydown'];\n    events.forEach(e => b.addEventListener(e, unlock, false));\n\n    function unlock() {\n      audioCtx.resume().then(clean);\n    }\n\n    function clean() {\n      events.forEach(e => b.removeEventListener(e, unlock));\n    }\n  }\n\n  var loadAudio = function() {\n    // Create Smart Audio Container\n    darworms.audioContext = new(window.AudioContext || window.webkitAudioContext)();\n\n    if (darworms.audioContext == null) {\n      darworms.dwsettings.doAudio = false;\n      alert(\" Could not load webAudio... muting game\");\n      $('#doAudio').hide();\n    }\n    unlockAudioContext(darworms.audioContext);\n    log(\"audio is \" + darworms.dwsettings.doAudio + \"  Context state is \" + darworms.audioContext.state);\n\n    if (darworms.dwsettings.doAudio) {\n      if (darworms.audioContext.createGain !== undefined) {\n        darworms.masterGainNode = darworms.audioContext.createGain(0.5);\n      }\n      if (darworms.audioContext.createStereoPanner !== undefined) {\n        darworms.audioPanner = darworms.audioContext.createStereoPanner();\n      }\n\n      //   loading AudioSample Files\n      /*\n      if (useKalimbaAudio) {\n        new AudioSample(\"b3\", \"sounds/a_kalimba_b3.wav\");\n        new AudioSample(\"c4\", \"sounds/b_kalimba_c4.wav\");\n        new AudioSample(\"d4\", \"sounds/c_kalimba_d4.wav\");\n        new AudioSample(\"e4\", \"sounds/d_kalimba_e4.wav\");\n        new AudioSample(\"fsharp4\", \"sounds/e_kalimba_fsharp4.wav\");\n        new AudioSample(\"g4\", \"sounds/f_kalimba_g4.wav\");\n        new AudioSample(\"a4\", \"sounds/g_kalimba_a4.wav\");\n        new AudioSample(\"b4\", \"sounds/h_kalimba_b4.wav\");\n        new AudioSample(\"c5\", \"sounds/i_kalimba_c5.wav\");\n        new AudioSample(\"b3\", \"sounds/j_kalimba_d5.wav\");\n        new AudioSample(\"e5\", \"sounds/k_kalimba_e5.wav\");\n        new AudioSample(\"fsharp5\", \"sounds/l_kalimba_fsharp5.wav\");\n        new AudioSample(\"g5\", \"sounds/m_kalimba_g5.wav\");\n        new AudioSample(\"a5\", \"sounds/n_kalimba_a5.wav\");\n        new AudioSample(\"b5\", \"sounds/o_kalimba_b5.wav\");\n        new AudioSample(\"c6\", \"sounds/p_kalimba_c6.wav\");\n\n      }\n      if (usePianoAudio) {\n        new AudioSample(\"a1\", \"sounds/piano/a1.wav\");\n        new AudioSample(\"a1s\", \"sounds/piano/a1s.wav\");\n        new AudioSample(\"b1\", \"sounds/piano/b1.wav\");\n        new AudioSample(\"c1\", \"sounds/piano/c1.wav\");\n        new AudioSample(\"c1s\", \"sounds/piano/c1s.wav\");\n        new AudioSample(\"c2\", \"sounds/piano/c2.wav\");\n        new AudioSample(\"d1\", \"sounds/piano/d1.wav\");\n        new AudioSample(\"d1s\", \"sounds/piano/a1.wav\");\n        new AudioSample(\"e1\", \"sounds/piano/e1.wav\");\n        new AudioSample(\"f1\", \"sounds/piano/f1.wav\");\n        new AudioSample(\"f1s\", \"sounds/piano/f1s.wav\");\n        new AudioSample(\"g1\", \"sounds/piano/g1.wav\");\n        new AudioSample(\"g1s\", \"sounds/piano/g1s.wav\");\n      }\n      if (useSitarAudio) {\n        new AudioSample(\"sitar1\", \"sounds/sitar/sitar1.wav\");\n        new AudioSample(\"sitar2\", \"sounds/sitar/sitar2.wav\");\n        new AudioSample(\"sitar3\", \"sounds/sitar/sitar3.wav\");\n        new AudioSample(\"sitar4\", \"sounds/sitar/sitar4.wav\");\n        new AudioSample(\"sitar5\", \"sounds/sitar/sitar5.wav\");\n        new AudioSample(\"sitar6\", \"sounds/sitar/sitar6.wav\");\n\n      }\n      */\n\n      new AudioSample(\"piano\", \"sounds/piano-c2.wav\");\n      new AudioSample(\"guitar\", \"sounds/GuitarTrimmed.wav\");\n      new AudioSample(\"kalimba\", \"sounds/i_kalimba_c5.wav\");\n      new AudioSample(\"sitar\", \"sounds/Sitar-C5.wav\");\n      new AudioSample(\"flute\", \"sounds/FluteC3Trimmed.wav\");\n      new AudioSample(\"clarinet\", \"sounds/ClarinetTrimmed.wav\");\n      new AudioSample(\"death\", \"sounds/darworm-death.wav\");\n\n    }\n    var twelfrootoftwo = 1.05946309436;\n    var noteRate = 0.5; // lowest note  C3\n    var noteFrequency = 261.626; // Middle C   (C4)\n    do {\n      darworms.audioPlaybackRates.push(noteRate);\n      darworms.audioFrequencies.push(noteFrequency * noteRate);\n      noteRate = noteRate * twelfrootoftwo;\n\n    }\n    while (darworms.audioPlaybackRates.length < 13);\n    log(\"Final rate = \" + darworms.audioPlaybackRates[12] + \"  error: \" +\n      (1.0 - darworms.audioPlaybackRates[12]));\n\n    darworms.audioPlaybackRates[12] = 1.0;\n\n\n\n    // context state at this time is `undefined` in iOS8 Safari\n    if (darworms.audioContext.state === 'suspended') {\n      var resume = function() {\n        darworms.audioContext.resume();\n\n        setTimeout(function() {\n          if (darworms.audioContext.state === 'running') {\n            document.body.removeEventListener('touchend', resume, false);\n          }\n        }, 0);\n      };\n\n      document.body.addEventListener('touchend', resume, false);\n    }\n\n  }\n\n  var initGlobals = function() {\n\n  }\n  var typeFromName = function(name) {\n    switch (name) {\n      case \"none\":\n        return 0;\n        break;\n      case \"random\":\n        return 1;\n        break;\n      case \"same\":\n        return 2;\n        break;\n      case \"new\":\n        return 3;\n        break\n\n      default:\n        alert(\"unknown type (not none, randowm, new or same)\");\n        return 0;\n    }\n  }\n\n  var init = function() {\n    // This may be needed when we actually build a phoneGap app\n    // in this case delay initialization until we get the deviceready event\n    document.addEventListener(\"deviceready\", deviceInfo, true);\n    console.log(\"development mode: \" + darworms.dwsettings.dologging);\n    console.log(\"width: \" + $(window).width());\n    $(\"#logging\").slider().val(darworms.dwsettings.dologging ? \"true\" : \"false\");\n\n    $('#versionstring')[0].innerHTML = \"Version \" + darworms.version;\n    // See if the url constains an encoded game\n    try {\n      const urlParams = new URLSearchParams(window.location.search);\n      log(location.search);\n      if (urlParams.has('darwormsgame')) {\n        darworms.gameTxt = decodeURIComponent(urlParams.get('darwormsgame'));\n        if (darworms.gameTxt) {\n          injectSettings(darworms.gameTxt);\n          //  go to Playpage here ?\n          scoreCanvasInit();\n          updateScores(gWorms);\n          $.mobile.changePage('#playpage');\n          darworms.dwsettings.forceInitialGridSize = false;\n        }\n      }\n    } catch (err) {\n      alert(\"Trouble parsing the url. Be sure to copy and paste the entire url starting with 'https' all way through to the lst '}' \\n\" + err.message);\n    };\n    graphicsInit();\n    darworms.dwsettings.isLargeScreen = $(window).width() >= darworms.dwsettings.minLargeScreenWidth;\n    darworms.dwsettings.isTinyScreen = $(window).width() < darworms.dwsettings.maxSmallSreenWidth;\n    if (darworms.dwsettings.forceInitialGridSize) {\n      darworms.dwsettings.gridSize = darworms.dwsettings.isLargeScreen ?\n        darworms.dwsettings.largeGridSize :\n        darworms.dwsettings.isTinyScreen ?\n          darworms.dwsettings.tinyGridSize :\n          darworms.dwsettings.smallGridSize;\n    }\n\n    darworms.wCanvasPixelDim = new Point(wCanvas.clientWidth, wCanvas.clientHeight); // log ( \" init wGraphics \" + darworms.main.wGraphics);\n    $('#wcanvas').bind('tap', wormEventHandler);\n    // $('#wcanvas').on(\"tap\", wormEventHandler);\n    // $('#wcanvas').bind('vmousedown', wormEventHandler);\n\n    // this should depend on scale factor.  On small screens\n    // we should set pickDirectionUI to true\n    $('#pickDirectionUI').slider().val(0);\n    $('#pickDirectionUI').slider(\"refresh\");\n\n    darworms.wCanvasRef = $('#wcanvas');\n\n    initGlobals();\n\n    loadAudio();\n\n    setButtonNames();\n\n    // applySettings();\n\n\n\n    gameInit(); // needed to init local data in the gameModule closure\n    //  These values are needed by both mainModule and gameModule\n    //  so for now we keep them as globals\n    //  Perhaps the time routines should all be moved into the gameModule closure\n    // and we can make some or all of these private to the gameModule closure\n    // darworms.theGame = new Game ( darworms.dwsettings.forceInitialGridSize, darworms.dwsettings.forceInitialGridSize);\n    // darworms.startgame(false);\n    darworms.dwsettings.noWhere = new Point(-1, -1);\n\n\n    //  The following code is designed to remove the toolbar on mobile Safari\n    if (!window.location.hash && window.addEventListener) {\n      window.addEventListener(\"load\", function() {\n        log(\"load event listener triggered\");\n        setTimeout(function() {\n          window.scrollTo(0, 0);\n        }, 100);\n      });\n      window.addEventListener(\"orientationchange\", function() {\n        setTimeout(function() {\n          window.scrollTo(0, 0);\n        }, 100);\n      });\n    }\n    $(window).bind('throttledresize orientationchange', function(event) {\n      window.scrollTo(1, 0);\n      log(\"resize event triggered\");\n      if (darworms.theGame) {\n        clearCanvas();\n      }\n      resizeCanvas();\n\n      if (darworms.theGame) {\n        reScale(darworms.theGame.grid.width, darworms.theGame.grid.height);\n      }\n    });\n\n    gWorms.forEach(function(worm, i) {\n      worm.setNotes(worm.instrument || 0);\n    })\n    resizeCanvas();\n    $(\"#p1button\").click(function() {\n      darworms.selectedIdx = 0;\n    });\n    $(\"#p2button\").click(function() {\n      darworms.selectedIdx = 1;\n    });\n    $(\"#p3button\").click(function() {\n      darworms.selectedIdx = 2;\n    });\n    $(\"#p4button\").click(function() {\n      darworms.selectedIdx = 3;\n    });\n    $(\"#nextbutton\").click(function() {\n      log(\" nextbutton clicked\");\n      $.mobile.changePage(\"#edit-darworm-page\", {\n        allowSamePageTransition: true\n      });\n      darworms.selectedIdx = ((darworms.selectedIdx + 1) % gWorms.length);\n      initEditPage(darworms.selectedIdx);\n      // $.mobile.changePage( \"#edit-darworm-page\", { allowSamePageTransition: true } );\n    });\n    $(\"input[name='edit-radio-choice']\").on(\"change\", function() {\n      log(\" edit-radio-choice on change function\");\n      var type = ($(\"input[name='edit-radio-choice']:checked\").val());\n      playerTypes[darworms.selectedIdx] = typeFromName(type);\n      gWorms[darworms.selectedIdx].init(typeFromName(type));\n      $('#edittextfield').val(typeFromName(type) == 0 ? \"\" : gWorms[darworms.selectedIdx].name);\n    });\n\n    $(\"input[name='edit-textname']\").on(\"change\", function() {\n      log(\" edit-textname\")\n      var dnastring = ($(\"input[name='edit-textname']\").val());\n      var regx = /^[ABCDEF\\?]{63}X$/;\n      if (regx.test(dnastring)) {\n        if (gWorms[darworms.selectedIdx].fromText(dnastring)) {\n          gWorms[darworms.selectedIdx].wType = 2; // Same\n          playerTypes[darworms.selectedIdx] = 2;\n          setupEditPage();\n\n\n          $(darworms.buttonSelectors[darworms.selectedIdx]).text(typeNames[playerTypes[darworms.selectedIdx]]);\n          $(darworms.buttonLSelectors[darworms.selectedIdx]).text(typeNames[playerTypes[darworms.selectedIdx]]);\n          gWorms[darworms.selectedIdx].toText();\n          $(\"input[name='edit-textname']\").textinput({\n            theme: darworms.themes[darworms.selectedIdx]\n          });\n        };\n      } else {\n        $(\"input[name='edit-textname']\").textinput({\n          theme: \"a\"\n        });\n      }\n    });\n  }\n\n  return {\n    init: init,\n    gWorms: gWorms,\n    setSelectedDarwormType: setSelectedDarwormType,\n    setupEditPage: setupEditPage,\n    applySettings: applySettings,\n    injectSettings: injectSettings,\n    showSettings: showSettings,\n    setupGridGeometry: setupGridGeometry,\n    initPlayPage: initPlayPage,\n    leavePlayPage: leavePlayPage,\n    wormEventHandler: wormEventHandler,\n    initEditPage: initEditPage,\n    leaveEditPage: leaveEditPage,\n    loadSavedGames: loadSavedGames,\n    freeSavedGames: freeSavedGames\n\n\n  };\n\n})();\n/* end of Game */\n"],"names":["log","str","$","slider","val","console","AudioSample","name","location","this","incomingbuffer","undefined","savedBuffer","xhr","XMLHttpRequest","open","responseType","onload","darworms","audioContext","decodeAudioData","response","incomingBuffer","bind","send","audioSamples","push","drawdna","canvas","darworm","cellstate","width","clientWidth","height","clientHeight","pGraphics","getContext","setTransform","fillStyle","dwsettings","cellBackground","backGroundTheme","strokeStyle","lineWidth","rect","fill","beginPath","moveTo","xPts","yPts","j","lineTo","stroke","mask","setLineDash","graphicsInit","game","wCanvas","document","getElementById","wGraphics","resizeCanvas","setGrid","currentGrid","grid","timeInDraw","frameTimes","length","startFrameTimes","theGame","setScale","gridWidth","gridHeight","scale","Point","reScale","format","clearCanvas","save","clearRect","fillRect","restore","startGameTimer","gameElapsedTime","Date","getTime","stopGameTimer","getOffset","point","xoff","yoff","y","x","gsetTranslate","cellOffset","drawCells","col","row","drawcell","now","owner","spokeAt","colorTable","graphics","vertex_x","vertex_y","closePath","alphaColorTable","arc","Math","PI","outvec","outVectorsAt","invec","inVectorsAt","i","outMask","outSpokeColor","lineCap","isSink","k","m","asterixSize","drawDirtyCells","pt","dirtyCells","pop","pushDirtyCell","pos","highlightWorm","worm","index","state","gameStates","waiting","colorIndex","animFrame","initPickUI","pickCells","Array","inVec","dir","pickTarget","next","color","focusWorm","wormColorIndex","drawPickCells","animFraction","pickDirectionUI","forEach","drawPickCell","drawPickCellOrigin","drawExpandedTarget","worms","activeColor","screenCoordinates","fillColorString","xloc","yloc","selectDirection","selectLargeUIDirection","selectSmallUIDirection","touchPoint","absdiff","absDiff","diff","gameState","setDNAandResumeGame","direction","dna","focusValue","numChoices","running","dist","stateAt","minDist","select","target","animateDyingWorms","whichWorm","uiFrames","wormStates","dying","animateDyingCell","drawShrikingOutline","dyningAnimationFrames","diedAtFrame","showTimes","min","max","ave","nFrames","sumTime","fps","round","totalElapsed","percentDrawing","innerHTML","delta","xc","canvasElement","sc","w","window","h","css","nw","floor","alert","needsRedraw","scoreCanvasInit","scoreCanvas","scorectx","font","shadowColor","shadowOffsetX","shadowOffsetY","clearScore","segmentIndex","totalSegments","segWidth","scoreStartx","text","measureText","updateScores","wormArray","aworm","shouldDrawScore","fillText","score","toString","pick","o","fields","reduce","a","hasOwnProperty","addPick","Object","assign","gameName","createdAt","nplayers","players","typeName","substr","indexOf","emailGame","gameText","mailtourl","encodeURIComponent","host","encodeGame","settings","version","gameObj","valueOf","wrm","toText","gameTxt","JSON","stringify","gameUrl","testOne","decodeURIComponent","testTwo","parse","testThree","loadGames","data","localStorage","getItem","savedgames","liStr","append","listview","on","event","attr","parseInt","splice","setItem","refreshSavedGames","main","injectSettings","gWorms","mobile","changePage","freeGames","svgamelist","firstChild","removeChild","saveGame","makeMoves","startTime","over","makeMove","doAnimations","clearInterval","timer","getAvePos","elapsed","gameInit","nextToMove","[object Object]","other","sqrt","abs","wg","hg","privateString","compassPts","paused","animToUI","animFromUI","dead","moving","sleeping","wormStateNames","initialWormStates","themes","selectedIdx","gameStateNames","inMask","colorNames","buttonSelectors","buttonLSelectors","inDir","wCanvasPixelDim","wCanvasRef","minTwoColumnWidth","leftColumnWidth","screens","rawFrameCount","drawFrameCount","uiFrameCount","frameInterval","uifps","uiInterval","then","uiThen","uiElapsed","vertex_fudge","hexSize","sqrt3","selectedDarworm","notes","C1","CS","DF","D","DS","EF","E","F","FS","GF","G","GS","FF","AF","A","AS","BF","B","C2","forceInitialGridSize","largeGridSize","smallGridSize","tinyGridSize","minLargeScreenWidth","maxSmallSreenWidth","isLargeScreen","doAudio","fixedInitPos","noWhere","gridGeometry","codons","e","ne","sw","se","unSet","isTrapped","gridBackground","masterAudioVolume","dologging","gridSize","images","masterGainNode","audioPanner","audioPlaybackRates","audioFrequencies","addEventListener","onerror","msg","url","line","setupEditPage","setSelectedDarwormType","showSettings","setupGridGeometry","applySettings","initPlayPage","leavePlayPage","initEditPage","leaveditPage","loadSavedGames","freeSavedGames","popup","afterclose","ui","prop","showTutorial","init","prototype","playSample","rate","pan","source","createBufferSource","buffer","gain","value","connect","destination","start","playbackRate","evenRowVec","oddRowVec","spokeMask","sinkMask","Grid","cells","colors","clear","topPoint","botPoint","setValueAt","valueAt","setSpokeAt","leftPoint","rightPoint","from","to","captures","nP","add","action","colorsAt","hexValueAt","dirList","list","musicalkeys","AMajor","BMajor","CMajor","CMinor","DMajor","EMajor","FMajor","GMajor","Worm","nMoves","prevScore","died","wType","directionIndex","musickeyName","MusicScale","audioSamplesPtrs","startingPos","randomize","n","instrument","keyName","sorted","sort","b","setTimeout","that","random","aState","aGame","spokes","spoke","dnastring","test","gooddna","charAt","focusPoint","maxpan","Game","numTurns","numMoves","activeIndex","origin","avePos","focusValure","zoomFrame","startx","starty","endx","endy","startscale","endScale","targetZoomFrames","bullseyeoffset","each","nActiveAve","active","graphicsOn","nAlive","currentState","getMoveDir","btns","positionTo","isEqualTo","didScore","move","panValue","image","Image","src","toDataURL","unlockAudioContext","audioCtx","unlock","resume","clean","events","removeEventListener","body","deviceInfo","screen","colorDepth","playerTypes","buttonNames","typeNames","textFields","setButtonNames","removeClass","addClass","hide","show","darwormType","checkboxradio","textinput","theme","regx","fromText","setNotes","pointerEventToXY","out","type","touch","originalEvent","touches","changedTouches","pageX","pageY","clientX","currentTarget","clientY","wormEventHandler","loc","touchX","touchY","menuButton","setKeyVal","selectedKeyInput","setKey","setInstrumentVal","selectedInstrumentInput","sendemail","startgame","startNow","curScreen","innerWidth","innerHeight","initGame","startingPoint","place","setSinkAt","animFramesPerSec","startGameLoop","initTheGame","frameRate","iufps","doGameLoop","ig","requestAnimationFrame","abortgame","emailDarwormButton","emailDarworm","playScale","yesabortgame","noabortgame","swapTheme","selector","newTheme","page","foo","selectmenu","trigger","loadAudio","AudioContext","webkitAudioContext","createGain","createStereoPanner","noteRate","typeFromName","urlParams","URLSearchParams","search","has","get","err","message","isTinyScreen","hash","scrollTo","click","allowSamePageTransition","overflow","background","playpageInitialized","leaveEditPage"],"mappings":"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"}